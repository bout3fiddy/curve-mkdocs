<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=CurveFi><link href=https://bout3fiddy.github.io/curve-mkdocs/stableswap_exchange/deposit_contracts/lending_pool_deposits/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.2.6"><title>Lending Pool Deposits - Curve Docs</title><link rel=stylesheet href=../../../assets/stylesheets/main.9d5733d3.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../css/timeago.css><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=red> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#deposit-zap-old class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Curve Docs" class="md-header__button md-logo" aria-label="Curve Docs" data-md-component=logo> <img src=../../../images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Curve Docs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Lending Pool Deposits </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/bout3fiddy/curve-mkdocs.git/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> bout3fiddy/curve-mkdocs </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Curve Docs" class="md-nav__button md-logo" aria-label="Curve Docs" data-md-component=logo> <img src=../../../images/logo.png alt=logo> </a> Curve Docs </label> <div class=md-nav__source> <a href=https://github.com/bout3fiddy/curve-mkdocs.git/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> bout3fiddy/curve-mkdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1 checked> <label class=md-nav__link for=__nav_1> Stableswap Exchange <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Stableswap Exchange" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Stableswap Exchange </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../overview/ class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 data-md-state=indeterminate type=checkbox id=__nav_1_2 checked> <label class=md-nav__link for=__nav_1_2> Pools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Pools data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Pools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../pools/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../pools/plain_pools/ class=md-nav__link> Plain Pools </a> </li> <li class=md-nav__item> <a href=../../pools/lending_pools/ class=md-nav__link> Lending Pools </a> </li> <li class=md-nav__item> <a href=../../pools/metapools/ class=md-nav__link> Metapools </a> </li> <li class=md-nav__item> <a href=../../pools/admin_pool_settings/ class=md-nav__link> Admin Controls </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_3 data-md-state=indeterminate type=checkbox id=__nav_1_3 checked> <label class=md-nav__link for=__nav_1_3> Liquidity Pool Tokens <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Liquidity Pool Tokens" data-md-level=2> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Liquidity Pool Tokens </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lp_tokens/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../lp_tokens/curve_token_v1/ class=md-nav__link> Curve Token V1 </a> </li> <li class=md-nav__item> <a href=../../lp_tokens/curve_token_v2/ class=md-nav__link> Curve Token V2 </a> </li> <li class=md-nav__item> <a href=../../lp_tokens/curve_token_v3/ class=md-nav__link> Curve Token V3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_4 type=checkbox id=__nav_1_4 checked> <label class=md-nav__link for=__nav_1_4> Deposit Contracts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Deposit Contracts" data-md-level=2> <label class=md-nav__title for=__nav_1_4> <span class="md-nav__icon md-icon"></span> Deposit Contracts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Lending Pool Deposits <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Lending Pool Deposits </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#deposit-zap-old class=md-nav__link> Deposit Zap (Old) </a> <nav class=md-nav aria-label="Deposit Zap (Old)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-deposit-zap-information class=md-nav__link> Get Deposit Zap Information </a> <nav class=md-nav aria-label="Get Deposit Zap Information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depositzapcurve class=md-nav__link> DepositZap.curve </a> </li> <li class=md-nav__item> <a href=#depositzapunderlying_coins class=md-nav__link> DepositZap.underlying_coins </a> </li> <li class=md-nav__item> <a href=#depositzapcoins class=md-nav__link> DepositZap.coins </a> </li> <li class=md-nav__item> <a href=#depositzaptoken class=md-nav__link> DepositZap.token </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#addremove-liquidity class=md-nav__link> Add/Remove Liquidity </a> <nav class=md-nav aria-label="Add/Remove Liquidity"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depositzapadd_liquidity class=md-nav__link> DepositZap.add_liquidity </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity class=md-nav__link> DepositZap.remove_liquidity </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_imbalance class=md-nav__link> DepositZap.remove_liquidity_imbalance </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_one_coin class=md-nav__link> DepositZap.remove_liquidity_one_coin </a> </li> <li class=md-nav__item> <a href=#depositzapcalc_withdraw_one_coin class=md-nav__link> DepositZap.calc_withdraw_one_coin </a> </li> <li class=md-nav__item> <a href=#depositzapwithdraw_donated_dust class=md-nav__link> DepositZap.withdraw_donated_dust </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deposit-zap-new class=md-nav__link> Deposit Zap (New) </a> <nav class=md-nav aria-label="Deposit Zap (New)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-deposit-zap-information_1 class=md-nav__link> Get Deposit Zap Information </a> <nav class=md-nav aria-label="Get Deposit Zap Information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depositzapcurve_1 class=md-nav__link> DepositZap.curve </a> </li> <li class=md-nav__item> <a href=#depositzapunderlying_coins_1 class=md-nav__link> DepositZap.underlying_coins </a> </li> <li class=md-nav__item> <a href=#depositzapcoins_1 class=md-nav__link> DepositZap.coins </a> </li> <li class=md-nav__item> <a href=#depositzaptoken_1 class=md-nav__link> DepositZap.token </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#addremove-liquidity_1 class=md-nav__link> Add/Remove Liquidity </a> <nav class=md-nav aria-label="Add/Remove Liquidity"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depositzapadd_liquidity_1 class=md-nav__link> DepositZap.add_liquidity </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_1 class=md-nav__link> DepositZap.remove_liquidity </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_imbalance_1 class=md-nav__link> DepositZap.remove_liquidity_imbalance </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_one_coin_1 class=md-nav__link> DepositZap.remove_liquidity_one_coin </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../metapool_deposits/ class=md-nav__link> Metapool Deposits </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_5 data-md-state=indeterminate type=checkbox id=__nav_1_5 checked> <label class=md-nav__link for=__nav_1_5> Cross Asset Swaps <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cross Asset Swaps" data-md-level=2> <label class=md-nav__title for=__nav_1_5> <span class="md-nav__icon md-icon"></span> Cross Asset Swaps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cross_asset_swaps/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../cross_asset_swaps/synthswap_exchange/ class=md-nav__link> SynthSwap </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 data-md-state=indeterminate type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Cryptoswap Exchange <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cryptoswap Exchange" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Cryptoswap Exchange </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cryptoswap_exchange/overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 data-md-state=indeterminate type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Curve DAO <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Curve DAO" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Curve DAO </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../curve_dao/overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 data-md-state=indeterminate type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Registry <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Registry data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Registry </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../registry/overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 data-md-state=indeterminate type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Factory <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Factory data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Factory </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../factory/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../factory/deployer_api/ class=md-nav__link> Deployer API </a> </li> <li class=md-nav__item> <a href=../../../factory/registry_api/ class=md-nav__link> Registry API </a> </li> <li class=md-nav__item> <a href=../../../factory/admin_controls/ class=md-nav__link> Admin Controls </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#deposit-zap-old class=md-nav__link> Deposit Zap (Old) </a> <nav class=md-nav aria-label="Deposit Zap (Old)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-deposit-zap-information class=md-nav__link> Get Deposit Zap Information </a> <nav class=md-nav aria-label="Get Deposit Zap Information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depositzapcurve class=md-nav__link> DepositZap.curve </a> </li> <li class=md-nav__item> <a href=#depositzapunderlying_coins class=md-nav__link> DepositZap.underlying_coins </a> </li> <li class=md-nav__item> <a href=#depositzapcoins class=md-nav__link> DepositZap.coins </a> </li> <li class=md-nav__item> <a href=#depositzaptoken class=md-nav__link> DepositZap.token </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#addremove-liquidity class=md-nav__link> Add/Remove Liquidity </a> <nav class=md-nav aria-label="Add/Remove Liquidity"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depositzapadd_liquidity class=md-nav__link> DepositZap.add_liquidity </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity class=md-nav__link> DepositZap.remove_liquidity </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_imbalance class=md-nav__link> DepositZap.remove_liquidity_imbalance </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_one_coin class=md-nav__link> DepositZap.remove_liquidity_one_coin </a> </li> <li class=md-nav__item> <a href=#depositzapcalc_withdraw_one_coin class=md-nav__link> DepositZap.calc_withdraw_one_coin </a> </li> <li class=md-nav__item> <a href=#depositzapwithdraw_donated_dust class=md-nav__link> DepositZap.withdraw_donated_dust </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deposit-zap-new class=md-nav__link> Deposit Zap (New) </a> <nav class=md-nav aria-label="Deposit Zap (New)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-deposit-zap-information_1 class=md-nav__link> Get Deposit Zap Information </a> <nav class=md-nav aria-label="Get Deposit Zap Information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depositzapcurve_1 class=md-nav__link> DepositZap.curve </a> </li> <li class=md-nav__item> <a href=#depositzapunderlying_coins_1 class=md-nav__link> DepositZap.underlying_coins </a> </li> <li class=md-nav__item> <a href=#depositzapcoins_1 class=md-nav__link> DepositZap.coins </a> </li> <li class=md-nav__item> <a href=#depositzaptoken_1 class=md-nav__link> DepositZap.token </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#addremove-liquidity_1 class=md-nav__link> Add/Remove Liquidity </a> <nav class=md-nav aria-label="Add/Remove Liquidity"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#depositzapadd_liquidity_1 class=md-nav__link> DepositZap.add_liquidity </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_1 class=md-nav__link> DepositZap.remove_liquidity </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_imbalance_1 class=md-nav__link> DepositZap.remove_liquidity_imbalance </a> </li> <li class=md-nav__item> <a href=#depositzapremove_liquidity_one_coin_1 class=md-nav__link> DepositZap.remove_liquidity_one_coin </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/bout3fiddy/curve-mkdocs.git/edit/master/docs/stableswap_exchange/deposit_contracts/lending_pool_deposits.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Lending Pool Deposits</h1> <p>While Curve lending pools support swaps in both the wrapped <em>and</em> underlying coins, not all lending pools allow liquidity providers to deposit or withdraw the underlying coin.</p> <p>For example, the <code>Compound</code> Pool allows swaps between <code>cDai</code> and <code>cUSDC</code> (wrapped coins), as well as swaps between <code>DAI</code> and <code>USDC</code> (underlying coins). However, liquidity providers are not able to deposit <code>DAI</code> or <code>USDC</code> to the pool directly. The main reason for why this is not supported by all Curve lending pools lies in the <a href=https://github.com/ethereum/EIPs/blob/master/EIPS/eip-170.md>size limit of contracts</a>. Lending pools may differ in complexity and can end up being very close to the contract byte code size limit. In order to overcome this restriction, liquidity can be added and removed to and from a lending pool in the underlying coins via a different contract, called a deposit zap, tailored to lending pools.</p> <p>For an overview of the Curve lending pool implementation, please refer to the Lending Pool section.</p> <p>The template source code for a lending pool deposit zap may be viewed on <a href=https://github.com/curvefi/curve-contract/blob/master/contracts/pool-templates/y/DepositTemplateY.vy>GitHub</a>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Lending pool deposit zaps may differ in their API. Older pools do not implement the <a href=https://github.com/curvefi/curve-contract/blob/master/contracts/pool-templates/y/DepositTemplateY.vy>newer API template</a>.</p> </div> <h2 id=deposit-zap-old>Deposit Zap (Old)<a class=headerlink href=#deposit-zap-old title="Permanent link">&para;</a></h2> <p>Older Curve lending pool deposit zaps do not implement the <a href=https://github.com/curvefi/curve-contract/blob/master/contracts/pool-templates/y/DepositTemplateY.vy>template API</a>. The deposit zaps which employ an older API are:</p> <ul> <li> <p><code>DepositBUSD</code>: <a href=https://etherscan.io/address/0xb6c057591e073249f2d9d88ba59a46cfc9b59edb#code>BUSD pool deposit zap</a></p> </li> <li> <p><code>DepositCompound</code>: <a href=https://etherscan.io/address/0xeb21209ae4c2c9ff2a86aca31e123764a3b6bc06#code>Compound pool deposit zap</a></p> </li> <li> <p><code>DepositPAX</code>: <a href=https://etherscan.io/address/0xa50ccc70b6a011cffddf45057e39679379187287#code>PAX pool deposit zap</a></p> </li> <li> <p><code>DepositUSDT</code>: <a href=https://etherscan.io/address/0xac795d2c97e60df6a99ff1c814727302fd747a80#code>USDT pool deposit zap</a></p> </li> <li> <p><code>DepositY</code>: <a href=https://etherscan.io/address/0xbbc81d23ea2c3ec7e56d39296f0cbb648873a5d3#code>Y pool deposit zap</a></p> </li> </ul> <p>While not a lending pool, note that the following contract also implements the newer deposit zap API:</p> <ul> <li><code>DepositSUSD</code>: <a href=https://etherscan.io/address/0xfcba3e75865d2d561be8d220616520c171f12851#code>SUSD pool deposit zap</a></li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Getters generated for public arrays changed between Vyper <code>0.1.x</code> and <code>0.2.x</code> to accept <code>uint256</code> instead of <code>int128</code> in order to handle the lookups. Older deposit zap contracts (v1) use vyper <code>0.1.x...</code>, while newer zaps (v2) use vyper <code>0.2.x...</code>.</p> </div> <p>The following Brownie console interaction examples are using the <a href=https://etherscan.io/address/0xeb21209ae4c2c9ff2a86aca31e123764a3b6bc06>Compound Pool Deposit Zap</a>.</p> <h3 id=get-deposit-zap-information>Get Deposit Zap Information<a class=headerlink href=#get-deposit-zap-information title="Permanent link">&para;</a></h3> <h4 id=depositzapcurve><code>DepositZap.curve</code><a class=headerlink href=#depositzapcurve title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.curve() → address: view</code></p> <p>Getter for the pool associated with this deposit contract.</p> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=n>coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
<span class=n>underlying_coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
<span class=hll><span class=n>curve</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>)</span>
</span><span class=n>token</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>)</span>

<span class=o>...</span>

<span class=nd>@public</span>
<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=n>_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>_underlying_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
             <span class=n>_curve</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_token</span><span class=p>:</span> <span class=n>address</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>coins</span> <span class=o>=</span> <span class=n>_coins</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span> <span class=o>=</span> <span class=n>_underlying_coins</span>
<span class=hll>    <span class=bp>self</span><span class=o>.</span><span class=n>curve</span> <span class=o>=</span> <span class=n>_curve</span>
</span>    <span class=bp>self</span><span class=o>.</span><span class=n>token</span> <span class=o>=</span> <span class=n>_token</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=1:1><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; zap.curve<span class=o>()</span>
<span class=s1>&#39;0xA2B47E3D5c44877cca798226B7B8118F9BFb7A56&#39;</span>
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapunderlying_coins><code>DepositZap.underlying_coins</code><a class=headerlink href=#depositzapunderlying_coins title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.underlying_coins(i: int128) → address: view</code></p> <p>Getter for the array of underlying coins within the associated pool.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>i</code></td> <td><code>int128</code></td> <td>Index of the underlying coin for which to get the address</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=n>N_COINS</span><span class=p>:</span> <span class=n>constant</span><span class=p>(</span><span class=n>int128</span><span class=p>)</span> <span class=o>=</span> <span class=mi>4</span>

<span class=o>...</span>

<span class=n>coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
<span class=hll><span class=n>underlying_coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
</span><span class=n>curve</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>)</span>
<span class=n>token</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>)</span>

<span class=o>...</span>

<span class=nd>@public</span>
<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=n>_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>_underlying_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
             <span class=n>_curve</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_token</span><span class=p>:</span> <span class=n>address</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>coins</span> <span class=o>=</span> <span class=n>_coins</span>
<span class=hll>    <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span> <span class=o>=</span> <span class=n>_underlying_coins</span>
</span>    <span class=bp>self</span><span class=o>.</span><span class=n>curve</span> <span class=o>=</span> <span class=n>_curve</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>token</span> <span class=o>=</span> <span class=n>_token</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=2:1><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; zap.underlying_coins<span class=o>(</span><span class=m>0</span><span class=o>)</span>
<span class=s1>&#39;0x6B175474E89094C44Da98b954EedeAC495271d0F&#39;</span>
&gt;&gt;&gt; zap.underlying_coins<span class=o>(</span><span class=m>1</span><span class=o>)</span>
<span class=s1>&#39;0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48&#39;</span>
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapcoins><code>DepositZap.coins</code><a class=headerlink href=#depositzapcoins title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.coins(i: int128) → address: view</code></p> <p>Getter for the array of wrapped coins within the associated pool.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>i</code></td> <td><code>int128</code></td> <td>Index of the coin for which to get the address</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=n>N_COINS</span><span class=p>:</span> <span class=n>constant</span><span class=p>(</span><span class=n>int128</span><span class=p>)</span> <span class=o>=</span> <span class=mi>4</span>

<span class=o>...</span>

<span class=hll><span class=n>coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
</span><span class=n>underlying_coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
<span class=n>curve</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>)</span>
<span class=n>token</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>)</span>

<span class=o>...</span>

<span class=nd>@public</span>
<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=n>_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>_underlying_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
             <span class=n>_curve</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_token</span><span class=p>:</span> <span class=n>address</span><span class=p>):</span>
<span class=hll>    <span class=bp>self</span><span class=o>.</span><span class=n>coins</span> <span class=o>=</span> <span class=n>_coins</span>
</span>    <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span> <span class=o>=</span> <span class=n>_underlying_coins</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>curve</span> <span class=o>=</span> <span class=n>_curve</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>token</span> <span class=o>=</span> <span class=n>_token</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; zap.coins<span class=o>(</span><span class=m>0</span><span class=o>)</span>
<span class=s1>&#39;0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643&#39;</span>
&gt;&gt;&gt; zap.coins<span class=o>(</span><span class=m>1</span><span class=o>)</span>
<span class=s1>&#39;0x39AA39c021dfbaE8faC545936693aC917d5E7563&#39;</span>
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzaptoken><code>DepositZap.token</code><a class=headerlink href=#depositzaptoken title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.token() → address: view</code></p> <p>Getter for the LP token of the associated pool.</p> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=n>coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
<span class=n>underlying_coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
<span class=n>curve</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>)</span>
<span class=hll><span class=n>token</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>)</span>
</span>
<span class=o>...</span>

<span class=nd>@public</span>
<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=n>_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>_underlying_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
             <span class=n>_curve</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_token</span><span class=p>:</span> <span class=n>address</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>coins</span> <span class=o>=</span> <span class=n>_coins</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span> <span class=o>=</span> <span class=n>_underlying_coins</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>curve</span> <span class=o>=</span> <span class=n>_curve</span>
<span class=hll>    <span class=bp>self</span><span class=o>.</span><span class=n>token</span> <span class=o>=</span> <span class=n>_token</span>
</span></code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=4:1><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; zap.coins<span class=o>(</span><span class=m>0</span><span class=o>)</span>
<span class=s1>&#39;0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643&#39;</span>
&gt;&gt;&gt; zap.coins<span class=o>(</span><span class=m>1</span><span class=o>)</span>
<span class=s1>&#39;0x39AA39c021dfbaE8faC545936693aC917d5E7563&#39;</span>
</code></pre></div> </div> </div> </div> </div> <h3 id=addremove-liquidity>Add/Remove Liquidity<a class=headerlink href=#addremove-liquidity title="Permanent link">&para;</a></h3> <h4 id=depositzapadd_liquidity><code>DepositZap.add_liquidity</code><a class=headerlink href=#depositzapadd_liquidity title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.add_liquidity(uamounts: uint256[N_COINS], min_mint_amount: uint256)</code></p> <p>Wrap underlying coins and deposit them in the pool.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>uamounts</code></td> <td><code>uint256[N_COINS]</code></td> <td>List of amounts of underlying coins to deposit</td> </tr> <tr> <td><code>min_mint_amount</code></td> <td><code>uint256</code></td> <td>Minimum amount of LP token to mint from the deposit</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">AddLiquidity</mark> <mark style="background-color: #FFD580; color: black">Transfer</mark> </p> <details class=quote> <summary>Source code</summary> <div class="tabbed-set tabbed-alternate" data-tabs=5:3><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><input id=__tabbed_5_2 name=__tabbed_5 type=radio><input id=__tabbed_5_3 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1>Zap Contract Methods</label><label for=__tabbed_5_2>Pool Methods</label><label for=__tabbed_5_3>Pool Token Methods</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=n>USE_LENDING</span><span class=p>:</span> <span class=n>constant</span><span class=p>(</span><span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span> <span class=o>=</span> <span class=p>[</span><span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>]</span>

<span class=o>...</span>

<span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>add_liquidity</span><span class=p>(</span><span class=n>uamounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>min_mint_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=n>tethered</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>TETHERED</span>
    <span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>uamount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>uamounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>

        <span class=k>if</span> <span class=n>uamount</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=c1># Transfer the underlying coin from owner</span>
            <span class=k>if</span> <span class=n>tethered</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
                <span class=n>USDT</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span>
                    <span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>uamount</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>\
                    <span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>uamount</span><span class=p>))</span>

            <span class=c1># Mint if needed</span>
            <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
                <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>approve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>uamount</span><span class=p>)</span>
                <span class=n>ok</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>cERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>mint</span><span class=p>(</span><span class=n>uamount</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>ok</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=s2>&quot;Could not mint coin&quot;</span>
                <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>cERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
                <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>approve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>,</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>uamount</span>
                <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>approve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>,</span> <span class=n>uamount</span><span class=p>)</span>

    <span class=n>Curve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>)</span><span class=o>.</span><span class=n>add_liquidity</span><span class=p>(</span><span class=n>amounts</span><span class=p>,</span> <span class=n>min_mint_amount</span><span class=p>)</span>

    <span class=n>tokens</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
    <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>tokens</span><span class=p>))</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>add_liquidity</span><span class=p>(</span><span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>min_mint_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=c1># Amounts is amounts of c-tokens</span>
    <span class=k>assert</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_killed</span>

    <span class=n>tethered</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>TETHERED</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=n>fees</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>
    <span class=n>_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fee</span> <span class=o>*</span> <span class=n>N_COINS</span> <span class=o>/</span> <span class=p>(</span><span class=mi>4</span> <span class=o>*</span> <span class=p>(</span><span class=n>N_COINS</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
    <span class=n>_admin_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>admin_fee</span>

    <span class=n>token_supply</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=o>.</span><span class=n>totalSupply</span><span class=p>()</span>
    <span class=n>rates</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_current_rates</span><span class=p>()</span>
    <span class=c1># Initial invariant</span>
    <span class=n>D0</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>old_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>balances</span>
    <span class=k>if</span> <span class=n>token_supply</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>D0</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>rates</span><span class=p>,</span> <span class=n>old_balances</span><span class=p>)</span>
    <span class=n>new_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>old_balances</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>token_supply</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span>
        <span class=c1># balances store amounts of c-tokens</span>
        <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>old_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>

    <span class=c1># Invariant after change</span>
    <span class=n>D1</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>rates</span><span class=p>,</span> <span class=n>new_balances</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>D1</span> <span class=o>&gt;</span> <span class=n>D0</span>

    <span class=c1># We need to recalculate the invariant accounting for fees</span>
    <span class=c1># to calculate fair user&#39;s share</span>
    <span class=n>D2</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>D1</span>
    <span class=k>if</span> <span class=n>token_supply</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=c1># Only account for fees if we are not the first to deposit</span>
        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
            <span class=n>ideal_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>D1</span> <span class=o>*</span> <span class=n>old_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>/</span> <span class=n>D0</span>
            <span class=n>difference</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>if</span> <span class=n>ideal_balance</span> <span class=o>&gt;</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
                <span class=n>difference</span> <span class=o>=</span> <span class=n>ideal_balance</span> <span class=o>-</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>difference</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>ideal_balance</span>
            <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>_fee</span> <span class=o>*</span> <span class=n>difference</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=p>(</span><span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>_admin_fee</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span><span class=p>)</span>
            <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=n>D2</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>rates</span><span class=p>,</span> <span class=n>new_balances</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>balances</span> <span class=o>=</span> <span class=n>new_balances</span>

    <span class=c1># Calculate, how much pool tokens to mint</span>
    <span class=n>mint_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>if</span> <span class=n>token_supply</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>mint_amount</span> <span class=o>=</span> <span class=n>D1</span>  <span class=c1># Take the dust if there was any</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>mint_amount</span> <span class=o>=</span> <span class=n>token_supply</span> <span class=o>*</span> <span class=p>(</span><span class=n>D2</span> <span class=o>-</span> <span class=n>D0</span><span class=p>)</span> <span class=o>/</span> <span class=n>D0</span>

    <span class=k>assert</span> <span class=n>mint_amount</span> <span class=o>&gt;=</span> <span class=n>min_mint_amount</span><span class=p>,</span> <span class=s2>&quot;Slippage screwed you&quot;</span>

    <span class=c1># Take coins from the sender</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>tethered</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>USDT</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>assert_modifiable</span><span class=p>(</span>
                <span class=n>cERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>

    <span class=c1># Mint pool tokens</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=o>.</span><span class=n>mint</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>mint_amount</span><span class=p>)</span>

    <span class=n>log</span><span class=o>.</span><span class=n>AddLiquidity</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>D1</span><span class=p>,</span> <span class=n>token_supply</span> <span class=o>+</span> <span class=n>mint_amount</span><span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@public</span>
<span class=k>def</span> <span class=nf>mint</span><span class=p>(</span><span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_value</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @dev Mint an amount of the token and assigns it to an account. </span>
<span class=sd>         This encapsulates the modification of balances such that the</span>
<span class=sd>         proper events are emitted.</span>
<span class=sd>    @param _to The account that will receive the created tokens.</span>
<span class=sd>    @param _value The amount that will be created.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>minter</span>
    <span class=k>assert</span> <span class=n>_to</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>total_supply</span> <span class=o>+=</span> <span class=n>_value</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>[</span><span class=n>_to</span><span class=p>]</span> <span class=o>+=</span> <span class=n>_value</span>
    <span class=n>log</span><span class=o>.</span><span class=n>Transfer</span><span class=p>(</span><span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=n>_to</span><span class=p>,</span> <span class=n>_value</span><span class=p>)</span>
</code></pre></div> </div> </div> </div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=6:1><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapremove_liquidity><code>DepositZap.remove_liquidity</code><a class=headerlink href=#depositzapremove_liquidity title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.remove_liquidity(_amount: uint256, min_uamounts: uint256[N_COINS])</code></p> <p>Withdraw and unwrap coins from the pool.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_amount</code></td> <td><code>uint256</code></td> <td>Quantity of LP tokens to burn in the withdrawal</td> </tr> <tr> <td><code>min_uamounts</code></td> <td><code>uint256[N_COINS]</code></td> <td>Minimum amounts of underlying coins to receive</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">RemoveLiquidity</mark></p> <details class=quote> <summary>Source code</summary> <div class="tabbed-set tabbed-alternate" data-tabs=7:3><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><input id=__tabbed_7_2 name=__tabbed_7 type=radio><input id=__tabbed_7_3 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1>Zap Contract Methods</label><label for=__tabbed_7_2>Pool Methods</label><label for=__tabbed_7_3>Pool Token Methods</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@private</span>
<span class=k>def</span> <span class=nf>_send_all</span><span class=p>(</span><span class=n>_addr</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>min_uamounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>one</span><span class=p>:</span> <span class=n>int128</span><span class=p>):</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=n>tethered</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>TETHERED</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>one</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>i</span> <span class=o>==</span> <span class=n>one</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
                <span class=n>_coin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
                <span class=n>_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>cERC20</span><span class=p>(</span><span class=n>_coin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>_balance</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># Do nothing if there are 0 coins</span>
                    <span class=k>continue</span>
                <span class=n>ok</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>cERC20</span><span class=p>(</span><span class=n>_coin</span><span class=p>)</span><span class=o>.</span><span class=n>redeem</span><span class=p>(</span><span class=n>_balance</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>ok</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=s2>&quot;Could not redeem coin&quot;</span>

            <span class=n>_ucoin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=n>_uamount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_ucoin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
            <span class=k>assert</span> <span class=n>_uamount</span> <span class=o>&gt;=</span> <span class=n>min_uamounts</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s2>&quot;Not enough coins withdrawn&quot;</span>

            <span class=c1># Send only if we have something to send</span>
            <span class=k>if</span> <span class=n>_uamount</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>tethered</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
                    <span class=n>USDT</span><span class=p>(</span><span class=n>_ucoin</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>_addr</span><span class=p>,</span> <span class=n>_uamount</span><span class=p>)</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=n>_ucoin</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>_addr</span><span class=p>,</span> <span class=n>_uamount</span><span class=p>))</span>


<span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity</span><span class=p>(</span><span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>min_uamounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]):</span>
    <span class=n>zeros</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>

    <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>_amount</span><span class=p>))</span>
    <span class=n>Curve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>)</span><span class=o>.</span><span class=n>remove_liquidity</span><span class=p>(</span><span class=n>_amount</span><span class=p>,</span> <span class=n>zeros</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>_send_all</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>min_uamounts</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity</span><span class=p>(</span><span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>min_amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]):</span>
    <span class=n>total_supply</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=o>.</span><span class=n>totalSupply</span><span class=p>()</span>
    <span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>
    <span class=n>fees</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>
    <span class=n>tethered</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>TETHERED</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>value</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>_amount</span> <span class=o>/</span> <span class=n>total_supply</span>
        <span class=k>assert</span> <span class=n>value</span> <span class=o>&gt;=</span> <span class=n>min_amounts</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s2>&quot;Withdrawal resulted in fewer coins than expected&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>value</span>
        <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
        <span class=k>if</span> <span class=n>tethered</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>USDT</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>cERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span>
                <span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>value</span><span class=p>))</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=o>.</span><span class=n>burnFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>  <span class=c1># Will raise if not enough</span>

    <span class=n>log</span><span class=o>.</span><span class=n>RemoveLiquidity</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>total_supply</span> <span class=o>-</span> <span class=n>_amount</span><span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@private</span>
<span class=k>def</span> <span class=nf>_burn</span><span class=p>(</span><span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_value</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @dev Internal function that burns an amount of the token of a given</span>
<span class=sd>         account.</span>
<span class=sd>    @param _to The account whose tokens will be burned.</span>
<span class=sd>    @param _value The amount that will be burned.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>_to</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>total_supply</span> <span class=o>-=</span> <span class=n>_value</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>[</span><span class=n>_to</span><span class=p>]</span> <span class=o>-=</span> <span class=n>_value</span>
    <span class=n>log</span><span class=o>.</span><span class=n>Transfer</span><span class=p>(</span><span class=n>_to</span><span class=p>,</span> <span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=n>_value</span><span class=p>)</span>

<span class=o>...</span>            

<span class=nd>@public</span>
<span class=k>def</span> <span class=nf>burnFrom</span><span class=p>(</span><span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_value</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @dev Burn an amount of the token from a given account.</span>
<span class=sd>    @param _to The account whose tokens will be burned.</span>
<span class=sd>    @param _value The amount that will be burned.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>minter</span><span class=p>,</span> <span class=s2>&quot;Only minter is allowed to burn&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_burn</span><span class=p>(</span><span class=n>_to</span><span class=p>,</span> <span class=n>_value</span><span class=p>)</span>
</code></pre></div> </div> </div> </div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=8:1><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><div class=tabbed-labels><label for=__tabbed_8_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapremove_liquidity_imbalance><code>DepositZap.remove_liquidity_imbalance</code><a class=headerlink href=#depositzapremove_liquidity_imbalance title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.remove_liquidity_imbalance(uamounts: uint256[N_COINS], max_burn_amount: uint256)</code></p> <p>Withdraw and unwrap coins from the pool in an imbalanced amount.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>uamounts</code></td> <td><code>uint256[N_COINS]</code></td> <td>List of amounts of underlying coins to withdraw</td> </tr> <tr> <td><code>max_burn_amount</code></td> <td><code>uint256</code></td> <td>Maximum amount of LP token to burn in the withdrawal</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">RemoveLiquidityImbalance</mark></p> <details class=quote> <summary>Source code</summary> <div class="tabbed-set tabbed-alternate" data-tabs=9:3><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><input id=__tabbed_9_2 name=__tabbed_9 type=radio><input id=__tabbed_9_3 name=__tabbed_9 type=radio><div class=tabbed-labels><label for=__tabbed_9_1>Zap Contract Methods</label><label for=__tabbed_9_2>Pool Methods</label><label for=__tabbed_9_3>Pool Token Methods</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@private</span>
<span class=k>def</span> <span class=nf>_send_all</span><span class=p>(</span><span class=n>_addr</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>min_uamounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>one</span><span class=p>:</span> <span class=n>int128</span><span class=p>):</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=n>tethered</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>TETHERED</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>one</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>i</span> <span class=o>==</span> <span class=n>one</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
                <span class=n>_coin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
                <span class=n>_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>cERC20</span><span class=p>(</span><span class=n>_coin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>_balance</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># Do nothing if there are 0 coins</span>
                    <span class=k>continue</span>
                <span class=n>ok</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>cERC20</span><span class=p>(</span><span class=n>_coin</span><span class=p>)</span><span class=o>.</span><span class=n>redeem</span><span class=p>(</span><span class=n>_balance</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>ok</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=s2>&quot;Could not redeem coin&quot;</span>

            <span class=n>_ucoin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=n>_uamount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_ucoin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
            <span class=k>assert</span> <span class=n>_uamount</span> <span class=o>&gt;=</span> <span class=n>min_uamounts</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s2>&quot;Not enough coins withdrawn&quot;</span>

            <span class=c1># Send only if we have something to send</span>
            <span class=k>if</span> <span class=n>_uamount</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>tethered</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
                    <span class=n>USDT</span><span class=p>(</span><span class=n>_ucoin</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>_addr</span><span class=p>,</span> <span class=n>_uamount</span><span class=p>)</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=n>_ucoin</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>_addr</span><span class=p>,</span> <span class=n>_uamount</span><span class=p>))</span>


<span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity_imbalance</span><span class=p>(</span><span class=n>uamounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>max_burn_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Get max_burn_amount in, remove requested liquidity and transfer back what is left</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=n>tethered</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>TETHERED</span>
    <span class=n>_token</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span>

    <span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>uamounts</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=ow>and</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>rate</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>cERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>exchangeRateCurrent</span><span class=p>()</span>
            <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>LENDING_PRECISION</span> <span class=o>/</span> <span class=n>rate</span>
        <span class=c1># if not use_lending - all good already</span>

    <span class=c1># Transfrer max tokens in</span>
    <span class=n>_tokens</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_token</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>_tokens</span> <span class=o>&gt;</span> <span class=n>max_burn_amount</span><span class=p>:</span>
        <span class=n>_tokens</span> <span class=o>=</span> <span class=n>max_burn_amount</span>
    <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=n>_token</span><span class=p>)</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>_tokens</span><span class=p>))</span>

    <span class=n>Curve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>)</span><span class=o>.</span><span class=n>remove_liquidity_imbalance</span><span class=p>(</span><span class=n>amounts</span><span class=p>,</span> <span class=n>max_burn_amount</span><span class=p>)</span>

    <span class=c1># Transfer unused tokens back</span>
    <span class=n>_tokens</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_token</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
    <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=n>_token</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>_tokens</span><span class=p>))</span>

    <span class=c1># Unwrap and transfer all the coins we&#39;ve got</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_send_all</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>ZEROS</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity_imbalance</span><span class=p>(</span><span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>max_burn_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=k>assert</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_killed</span>
    <span class=n>tethered</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>TETHERED</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>

    <span class=n>token_supply</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=o>.</span><span class=n>totalSupply</span><span class=p>()</span>
    <span class=k>assert</span> <span class=n>token_supply</span> <span class=o>&gt;</span> <span class=mi>0</span>
    <span class=n>_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fee</span> <span class=o>*</span> <span class=n>N_COINS</span> <span class=o>/</span> <span class=p>(</span><span class=mi>4</span> <span class=o>*</span> <span class=p>(</span><span class=n>N_COINS</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
    <span class=n>_admin_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>admin_fee</span>
    <span class=n>rates</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_current_rates</span><span class=p>()</span>

    <span class=n>old_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>balances</span>
    <span class=n>new_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>old_balances</span>
    <span class=n>D0</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>rates</span><span class=p>,</span> <span class=n>old_balances</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=n>D1</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>rates</span><span class=p>,</span> <span class=n>new_balances</span><span class=p>)</span>
    <span class=n>fees</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>ideal_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>D1</span> <span class=o>*</span> <span class=n>old_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>/</span> <span class=n>D0</span>
        <span class=n>difference</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>if</span> <span class=n>ideal_balance</span> <span class=o>&gt;</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>difference</span> <span class=o>=</span> <span class=n>ideal_balance</span> <span class=o>-</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>difference</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>ideal_balance</span>
        <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>_fee</span> <span class=o>*</span> <span class=n>difference</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=p>(</span><span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>_admin_fee</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span><span class=p>)</span>
        <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=n>D2</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>rates</span><span class=p>,</span> <span class=n>new_balances</span><span class=p>)</span>

    <span class=n>token_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=p>(</span><span class=n>D0</span> <span class=o>-</span> <span class=n>D2</span><span class=p>)</span> <span class=o>*</span> <span class=n>token_supply</span> <span class=o>/</span> <span class=n>D0</span>
    <span class=k>assert</span> <span class=n>token_amount</span> <span class=o>&gt;</span> <span class=mi>0</span>
    <span class=k>assert</span> <span class=n>token_amount</span> <span class=o>&lt;=</span> <span class=n>max_burn_amount</span><span class=p>,</span> <span class=s2>&quot;Slippage screwed you&quot;</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>tethered</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>USDT</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>cERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=o>.</span><span class=n>burnFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>token_amount</span><span class=p>)</span>  <span class=c1># Will raise if not enough</span>

    <span class=n>log</span><span class=o>.</span><span class=n>RemoveLiquidityImbalance</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>D1</span><span class=p>,</span> <span class=n>token_supply</span> <span class=o>-</span> <span class=n>token_amount</span><span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@private</span>
<span class=k>def</span> <span class=nf>_burn</span><span class=p>(</span><span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_value</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @dev Internal function that burns an amount of the token of a given</span>
<span class=sd>         account.</span>
<span class=sd>    @param _to The account whose tokens will be burned.</span>
<span class=sd>    @param _value The amount that will be burned.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>_to</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>total_supply</span> <span class=o>-=</span> <span class=n>_value</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>[</span><span class=n>_to</span><span class=p>]</span> <span class=o>-=</span> <span class=n>_value</span>
    <span class=n>log</span><span class=o>.</span><span class=n>Transfer</span><span class=p>(</span><span class=n>_to</span><span class=p>,</span> <span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=n>_value</span><span class=p>)</span>

<span class=o>...</span>            

<span class=nd>@public</span>
<span class=k>def</span> <span class=nf>burnFrom</span><span class=p>(</span><span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_value</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @dev Burn an amount of the token from a given account.</span>
<span class=sd>    @param _to The account whose tokens will be burned.</span>
<span class=sd>    @param _value The amount that will be burned.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>minter</span><span class=p>,</span> <span class=s2>&quot;Only minter is allowed to burn&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_burn</span><span class=p>(</span><span class=n>_to</span><span class=p>,</span> <span class=n>_value</span><span class=p>)</span>
</code></pre></div> </div> </div> </div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=10:1><input checked=checked id=__tabbed_10_1 name=__tabbed_10 type=radio><div class=tabbed-labels><label for=__tabbed_10_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapremove_liquidity_one_coin><code>DepositZap.remove_liquidity_one_coin</code><a class=headerlink href=#depositzapremove_liquidity_one_coin title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.remove_liquidity_one_coin(_token_amount: uint256, i: int128, min_uamount: uint256, donate_dust: bool = False)</code></p> <p>Withdraw and unwrap a single coin from the pool.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_token_amount</code></td> <td><code>uint256</code></td> <td>Amount of LP tokens to burn in the withdrawal</td> </tr> <tr> <td><code>i</code></td> <td><code>int128</code></td> <td>Index value of the coin to withdraw</td> </tr> <tr> <td><code>min_uamount</code></td> <td><code>uint256</code></td> <td>Minimum amount of underlying coin to receive</td> </tr> <tr> <td><code>donate_dust</code></td> <td><code>bool</code></td> <td>Donates collected dust liquidity to <code>msg.sender</code></td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">RemoveLiquidityImbalance</mark></p> <details class=quote> <summary>Source code</summary> <div class="tabbed-set tabbed-alternate" data-tabs=11:3><input checked=checked id=__tabbed_11_1 name=__tabbed_11 type=radio><input id=__tabbed_11_2 name=__tabbed_11 type=radio><input id=__tabbed_11_3 name=__tabbed_11 type=radio><div class=tabbed-labels><label for=__tabbed_11_1>Zap Contract Methods</label><label for=__tabbed_11_2>Pool Methods</label><label for=__tabbed_11_3>Pool Token Methods</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity_one_coin</span><span class=p>(</span><span class=n>_token_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>i</span><span class=p>:</span> <span class=n>int128</span><span class=p>,</span> <span class=n>min_uamount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>donate_dust</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Remove _amount of liquidity all in a form of coin i</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=n>rates</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>
    <span class=n>_token</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span>

    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>j</span><span class=p>]:</span>
            <span class=n>rates</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>cERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>j</span><span class=p>])</span><span class=o>.</span><span class=n>exchangeRateCurrent</span><span class=p>()</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>rates</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>LENDING_PRECISION</span>

    <span class=n>dy</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calc_withdraw_one_coin</span><span class=p>(</span><span class=n>_token_amount</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>rates</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>dy</span> <span class=o>&gt;=</span> <span class=n>min_uamount</span><span class=p>,</span> <span class=s2>&quot;Not enough coins removed&quot;</span>

    <span class=n>assert_modifiable</span><span class=p>(</span>
        <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>_token_amount</span><span class=p>))</span>

    <span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>
    <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>dy</span> <span class=o>*</span> <span class=n>LENDING_PRECISION</span> <span class=o>/</span> <span class=n>rates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=n>token_amount_before</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_token</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
    <span class=n>Curve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>)</span><span class=o>.</span><span class=n>remove_liquidity_imbalance</span><span class=p>(</span><span class=n>amounts</span><span class=p>,</span> <span class=n>_token_amount</span><span class=p>)</span>

    <span class=c1># Unwrap and transfer all the coins we&#39;ve got</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_send_all</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>ZEROS</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>donate_dust</span><span class=p>:</span>
        <span class=c1># Transfer unused tokens back</span>
        <span class=n>token_amount_after</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_token</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>token_amount_after</span> <span class=o>&gt;</span> <span class=n>token_amount_before</span><span class=p>:</span>
            <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=n>_token</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span>
                <span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>token_amount_after</span> <span class=o>-</span> <span class=n>token_amount_before</span><span class=p>)</span>
            <span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity_imbalance</span><span class=p>(</span><span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>max_burn_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=k>assert</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_killed</span>
    <span class=n>tethered</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>TETHERED</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>

    <span class=n>token_supply</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=o>.</span><span class=n>totalSupply</span><span class=p>()</span>
    <span class=k>assert</span> <span class=n>token_supply</span> <span class=o>&gt;</span> <span class=mi>0</span>
    <span class=n>_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fee</span> <span class=o>*</span> <span class=n>N_COINS</span> <span class=o>/</span> <span class=p>(</span><span class=mi>4</span> <span class=o>*</span> <span class=p>(</span><span class=n>N_COINS</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
    <span class=n>_admin_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>admin_fee</span>
    <span class=n>rates</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_current_rates</span><span class=p>()</span>

    <span class=n>old_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>balances</span>
    <span class=n>new_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>old_balances</span>
    <span class=n>D0</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>rates</span><span class=p>,</span> <span class=n>old_balances</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=n>D1</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>rates</span><span class=p>,</span> <span class=n>new_balances</span><span class=p>)</span>
    <span class=n>fees</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>ideal_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>D1</span> <span class=o>*</span> <span class=n>old_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>/</span> <span class=n>D0</span>
        <span class=n>difference</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>if</span> <span class=n>ideal_balance</span> <span class=o>&gt;</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>difference</span> <span class=o>=</span> <span class=n>ideal_balance</span> <span class=o>-</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>difference</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>ideal_balance</span>
        <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>_fee</span> <span class=o>*</span> <span class=n>difference</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=p>(</span><span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>_admin_fee</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span><span class=p>)</span>
        <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=n>D2</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>rates</span><span class=p>,</span> <span class=n>new_balances</span><span class=p>)</span>

    <span class=n>token_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=p>(</span><span class=n>D0</span> <span class=o>-</span> <span class=n>D2</span><span class=p>)</span> <span class=o>*</span> <span class=n>token_supply</span> <span class=o>/</span> <span class=n>D0</span>
    <span class=k>assert</span> <span class=n>token_amount</span> <span class=o>&gt;</span> <span class=mi>0</span>
    <span class=k>assert</span> <span class=n>token_amount</span> <span class=o>&lt;=</span> <span class=n>max_burn_amount</span><span class=p>,</span> <span class=s2>&quot;Slippage screwed you&quot;</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>tethered</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>USDT</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>cERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=o>.</span><span class=n>burnFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>token_amount</span><span class=p>)</span>  <span class=c1># Will raise if not enough</span>

    <span class=n>log</span><span class=o>.</span><span class=n>RemoveLiquidityImbalance</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>D1</span><span class=p>,</span> <span class=n>token_supply</span> <span class=o>-</span> <span class=n>token_amount</span><span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@private</span>
<span class=k>def</span> <span class=nf>_burn</span><span class=p>(</span><span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_value</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @dev Internal function that burns an amount of the token of a given</span>
<span class=sd>         account.</span>
<span class=sd>    @param _to The account whose tokens will be burned.</span>
<span class=sd>    @param _value The amount that will be burned.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>_to</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>total_supply</span> <span class=o>-=</span> <span class=n>_value</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>[</span><span class=n>_to</span><span class=p>]</span> <span class=o>-=</span> <span class=n>_value</span>
    <span class=n>log</span><span class=o>.</span><span class=n>Transfer</span><span class=p>(</span><span class=n>_to</span><span class=p>,</span> <span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=n>_value</span><span class=p>)</span>

<span class=o>...</span>            

<span class=nd>@public</span>
<span class=k>def</span> <span class=nf>burnFrom</span><span class=p>(</span><span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_value</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @dev Burn an amount of the token from a given account.</span>
<span class=sd>    @param _to The account whose tokens will be burned.</span>
<span class=sd>    @param _value The amount that will be burned.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>minter</span><span class=p>,</span> <span class=s2>&quot;Only minter is allowed to burn&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_burn</span><span class=p>(</span><span class=n>_to</span><span class=p>,</span> <span class=n>_value</span><span class=p>)</span>
</code></pre></div> </div> </div> </div> </details> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The underlying pool method called when the older DepositZap contract's <code>remove_liquidity_one_coin</code> is called emits <mark style="background-color: #FFD580; color: black">RemoveLiquidityImbalance</mark> whereas the newer contract emits <mark style="background-color: #FFD580; color: black">RemoveLiquidityOne</mark>. This is because the older contracts do not have the <code>remove_liquidity_one_coin</code>, and instead use <code>remove_liquidity_imbalance</code>.</p> </div> <div class="tabbed-set tabbed-alternate" data-tabs=12:1><input checked=checked id=__tabbed_12_1 name=__tabbed_12 type=radio><div class=tabbed-labels><label for=__tabbed_12_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapcalc_withdraw_one_coin><code>DepositZap.calc_withdraw_one_coin</code><a class=headerlink href=#depositzapcalc_withdraw_one_coin title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.calc_withdraw_one_coin(_token_amount: uint256, i: int128) → uint256</code></p> <p>Calculate the amount received when withdrawing a single underlying coin.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_token_amount</code></td> <td><code>uint256</code></td> <td>Amount of LP tokens to burn in the withdrawal</td> </tr> <tr> <td><code>i</code></td> <td><code>int128</code></td> <td>Index value of the coin to withdraw</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@private</span>
<span class=nd>@constant</span>
<span class=k>def</span> <span class=nf>_calc_withdraw_one_coin</span><span class=p>(</span><span class=n>_token_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>i</span><span class=p>:</span> <span class=n>int128</span><span class=p>,</span> <span class=n>rates</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=c1># First, need to calculate</span>
    <span class=c1># * Get current D</span>
    <span class=c1># * Solve Eqn against y_i for D - _token_amount</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=c1># tethered: bool[N_COINS] = TETHERED</span>
    <span class=n>crv</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>curve</span>
    <span class=n>A</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>Curve</span><span class=p>(</span><span class=n>crv</span><span class=p>)</span><span class=o>.</span><span class=n>A</span><span class=p>()</span>
    <span class=n>fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>Curve</span><span class=p>(</span><span class=n>crv</span><span class=p>)</span><span class=o>.</span><span class=n>fee</span><span class=p>()</span> <span class=o>*</span> <span class=n>N_COINS</span> <span class=o>/</span> <span class=p>(</span><span class=mi>4</span> <span class=o>*</span> <span class=p>(</span><span class=n>N_COINS</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
    <span class=n>fee</span> <span class=o>+=</span> <span class=n>fee</span> <span class=o>*</span> <span class=n>FEE_IMPRECISION</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span>  <span class=c1># Overcharge to account for imprecision</span>
    <span class=n>precisions</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>PRECISION_MUL</span>
    <span class=n>total_supply</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span><span class=o>.</span><span class=n>totalSupply</span><span class=p>()</span>

    <span class=n>xp</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>PRECISION_MUL</span>
    <span class=n>S</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>xp</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>*=</span> <span class=n>Curve</span><span class=p>(</span><span class=n>crv</span><span class=p>)</span><span class=o>.</span><span class=n>balances</span><span class=p>(</span><span class=n>j</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>j</span><span class=p>]:</span>
            <span class=c1># Use stored rate b/c we have imprecision anyway</span>
            <span class=n>xp</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>xp</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>*</span> <span class=n>rates</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>/</span> <span class=n>LENDING_PRECISION</span>
        <span class=n>S</span> <span class=o>+=</span> <span class=n>xp</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
        <span class=c1># if not use_lending - all good already</span>

    <span class=n>D0</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>xp</span><span class=p>)</span>
    <span class=n>D1</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>D0</span> <span class=o>-</span> <span class=n>_token_amount</span> <span class=o>*</span> <span class=n>D0</span> <span class=o>/</span> <span class=n>total_supply</span>
    <span class=n>xp_reduced</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>xp</span>

    <span class=c1># xp = xp - fee * | xp * D1 / D0 - (xp - S * dD / D0 * (0, ... 1, ..0))|</span>
    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>dx_expected</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>b_ideal</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>xp</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>*</span> <span class=n>D1</span> <span class=o>/</span> <span class=n>D0</span>
        <span class=n>b_expected</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>xp</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>j</span> <span class=o>==</span> <span class=n>i</span><span class=p>:</span>
            <span class=n>b_expected</span> <span class=o>-=</span> <span class=n>S</span> <span class=o>*</span> <span class=p>(</span><span class=n>D0</span> <span class=o>-</span> <span class=n>D1</span><span class=p>)</span> <span class=o>/</span> <span class=n>D0</span>
        <span class=k>if</span> <span class=n>b_ideal</span> <span class=o>&gt;=</span> <span class=n>b_expected</span><span class=p>:</span>
            <span class=n>dx_expected</span> <span class=o>=</span> <span class=p>(</span><span class=n>b_ideal</span> <span class=o>-</span> <span class=n>b_expected</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>dx_expected</span> <span class=o>=</span> <span class=p>(</span><span class=n>b_expected</span> <span class=o>-</span> <span class=n>b_ideal</span><span class=p>)</span>
        <span class=n>xp_reduced</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>-=</span> <span class=n>fee</span> <span class=o>*</span> <span class=n>dx_expected</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span>

    <span class=n>dy</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>xp_reduced</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_y</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>xp_reduced</span><span class=p>,</span> <span class=n>D1</span><span class=p>)</span>
    <span class=n>dy</span> <span class=o>=</span> <span class=n>dy</span> <span class=o>/</span> <span class=n>precisions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>

    <span class=k>return</span> <span class=n>dy</span>


<span class=nd>@public</span>
<span class=nd>@constant</span>
<span class=k>def</span> <span class=nf>calc_withdraw_one_coin</span><span class=p>(</span><span class=n>_token_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>i</span><span class=p>:</span> <span class=n>int128</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=n>rates</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>

    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>j</span><span class=p>]:</span>
            <span class=n>rates</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>cERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>j</span><span class=p>])</span><span class=o>.</span><span class=n>exchangeRateStored</span><span class=p>()</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>rates</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>**</span> <span class=mi>18</span>

    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calc_withdraw_one_coin</span><span class=p>(</span><span class=n>_token_amount</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>rates</span><span class=p>)</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=13:1><input checked=checked id=__tabbed_13_1 name=__tabbed_13 type=radio><div class=tabbed-labels><label for=__tabbed_13_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapwithdraw_donated_dust><code>DepositZap.withdraw_donated_dust</code><a class=headerlink href=#depositzapwithdraw_donated_dust title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.withdraw_donated_dust()</code></p> <p>Donates any LP tokens of the associated pool held by this contract to the contract owner.</p> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>withdraw_donated_dust</span><span class=p>():</span>
    <span class=n>owner</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>Curve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>)</span><span class=o>.</span><span class=n>owner</span><span class=p>()</span>
    <span class=k>assert</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>==</span> <span class=n>owner</span>

    <span class=n>_token</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>token</span>
    <span class=n>assert_modifiable</span><span class=p>(</span>
        <span class=n>ERC20</span><span class=p>(</span><span class=n>_token</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>owner</span><span class=p>,</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_token</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)))</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=14:1><input checked=checked id=__tabbed_14_1 name=__tabbed_14 type=radio><div class=tabbed-labels><label for=__tabbed_14_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h2 id=deposit-zap-new>Deposit Zap (New)<a class=headerlink href=#deposit-zap-new title="Permanent link">&para;</a></h2> <p>Compared to the older deposit zaps, the newer zaps mainly optimize for gas efficiency. The API is only modified in part, specifically with regards to <code>return</code> values and variable naming.</p> <h3 id=get-deposit-zap-information_1>Get Deposit Zap Information<a class=headerlink href=#get-deposit-zap-information_1 title="Permanent link">&para;</a></h3> <h4 id=depositzapcurve_1><code>DepositZap.curve</code><a class=headerlink href=#depositzapcurve_1 title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.curve() → address: view</code></p> <p>Getter for the pool associated with this deposit contract.</p> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=n>_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
    <span class=n>_underlying_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
<span class=hll>    <span class=n>_curve</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span>
</span>    <span class=n>_token</span><span class=p>:</span> <span class=n>address</span>
<span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Contract constructor</span>
<span class=sd>    @dev Where a token does not use wrapping, use the same address</span>
<span class=sd>         for `_coins` and `_underlying_coins`</span>
<span class=sd>    @param _coins List of wrapped coin addresses</span>
<span class=sd>    @param _underlying_coins List of underlying coin addresses</span>
<span class=hll><span class=sd>    @param _curve Pool address</span>
</span><span class=sd>    @param _token Pool LP token address</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>assert</span> <span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=k>assert</span> <span class=n>_underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>

        <span class=c1># approve underlying and wrapped coins for infinite transfers</span>
        <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
            <span class=n>_underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
            <span class=n>concat</span><span class=p>(</span>
                <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;approve(address,uint256)&quot;</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>MAX_UINT256</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=p>),</span>
            <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
        <span class=n>_response</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
            <span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
            <span class=n>concat</span><span class=p>(</span>
                <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;approve(address,uint256)&quot;</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>_curve</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>MAX_UINT256</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=p>),</span>
            <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>coins</span> <span class=o>=</span> <span class=n>_coins</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span> <span class=o>=</span> <span class=n>_underlying_coins</span>
<span class=hll>    <span class=bp>self</span><span class=o>.</span><span class=n>curve</span> <span class=o>=</span> <span class=n>_curve</span>
</span>    <span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span> <span class=o>=</span> <span class=n>_token</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=15:1><input checked=checked id=__tabbed_15_1 name=__tabbed_15 type=radio><div class=tabbed-labels><label for=__tabbed_15_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; zap.curve<span class=o>()</span>
<span class=s1>&#39;0xA2B47E3D5c44877cca798226B7B8118F9BFb7A56&#39;</span>
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapunderlying_coins_1><code>DepositZap.underlying_coins</code><a class=headerlink href=#depositzapunderlying_coins_1 title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.underlying_coins(i: int128) → address: view</code></p> <p>Getter for the array of underlying coins within the associated pool.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>i</code></td> <td><code>int128</code></td> <td>Index of the underlying coin for which to get the address</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=hll><span class=n>underlying_coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
</span>
<span class=o>...</span>        

<span class=nd>@external</span>
<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=n>_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
<span class=hll>    <span class=n>_underlying_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
</span>    <span class=n>_curve</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span>
    <span class=n>_token</span><span class=p>:</span> <span class=n>address</span>
<span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Contract constructor</span>
<span class=sd>    @dev Where a token does not use wrapping, use the same address</span>
<span class=sd>         for `_coins` and `_underlying_coins`</span>
<span class=sd>    @param _coins List of wrapped coin addresses</span>
<span class=hll><span class=sd>    @param _underlying_coins List of underlying coin addresses</span>
</span><span class=sd>    @param _curve Pool address</span>
<span class=sd>    @param _token Pool LP token address</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>assert</span> <span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>
<span class=hll>        <span class=k>assert</span> <span class=n>_underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>
</span>
        <span class=c1># approve underlying and wrapped coins for infinite transfers</span>
        <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
<span class=hll>            <span class=n>_underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span>            <span class=n>concat</span><span class=p>(</span>
                <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;approve(address,uint256)&quot;</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>MAX_UINT256</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=p>),</span>
            <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
        <span class=n>_response</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
            <span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
            <span class=n>concat</span><span class=p>(</span>
                <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;approve(address,uint256)&quot;</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>_curve</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>MAX_UINT256</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=p>),</span>
            <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>coins</span> <span class=o>=</span> <span class=n>_coins</span>
<span class=hll>    <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span> <span class=o>=</span> <span class=n>_underlying_coins</span>
</span>    <span class=bp>self</span><span class=o>.</span><span class=n>curve</span> <span class=o>=</span> <span class=n>_curve</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span> <span class=o>=</span> <span class=n>_token</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=16:1><input checked=checked id=__tabbed_16_1 name=__tabbed_16 type=radio><div class=tabbed-labels><label for=__tabbed_16_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; zap.underlying_coins<span class=o>(</span><span class=m>0</span><span class=o>)</span>
<span class=s1>&#39;0x6B175474E89094C44Da98b954EedeAC495271d0F&#39;</span>
&gt;&gt;&gt; zap.underlying_coins<span class=o>(</span><span class=m>1</span><span class=o>)</span>
<span class=s1>&#39;0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48&#39;</span>
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapcoins_1><code>DepositZap.coins</code><a class=headerlink href=#depositzapcoins_1 title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.coins(i: int128) → address: view</code></p> <p>Getter for the array of wrapped coins within the associated pool.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>i</code></td> <td><code>int128</code></td> <td>Index of the coin for which to get the address</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=hll><span class=n>coins</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
</span>
<span class=o>...</span>        

<span class=nd>@external</span>
<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
<span class=hll>    <span class=n>_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
</span>    <span class=n>_underlying_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
    <span class=n>_curve</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span>
    <span class=n>_token</span><span class=p>:</span> <span class=n>address</span>
<span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Contract constructor</span>
<span class=sd>    @dev Where a token does not use wrapping, use the same address</span>
<span class=sd>         for `_coins` and `_underlying_coins`</span>
<span class=hll><span class=sd>    @param _coins List of wrapped coin addresses</span>
</span><span class=sd>    @param _underlying_coins List of underlying coin addresses</span>
<span class=sd>    @param _curve Pool address</span>
<span class=sd>    @param _token Pool LP token address</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
<span class=hll>        <span class=k>assert</span> <span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>
</span>        <span class=k>assert</span> <span class=n>_underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>

        <span class=c1># approve underlying and wrapped coins for infinite transfers</span>
        <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
            <span class=n>_underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
            <span class=n>concat</span><span class=p>(</span>
                <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;approve(address,uint256)&quot;</span><span class=p>),</span>
<span class=hll>                <span class=n>convert</span><span class=p>(</span><span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>bytes32</span><span class=p>),</span>
</span>                <span class=n>convert</span><span class=p>(</span><span class=n>MAX_UINT256</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=p>),</span>
            <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
        <span class=n>_response</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
<span class=hll>            <span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
</span>            <span class=n>concat</span><span class=p>(</span>
                <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;approve(address,uint256)&quot;</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>_curve</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>MAX_UINT256</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=p>),</span>
            <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>

<span class=hll>    <span class=bp>self</span><span class=o>.</span><span class=n>coins</span> <span class=o>=</span> <span class=n>_coins</span>
</span>    <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span> <span class=o>=</span> <span class=n>_underlying_coins</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>curve</span> <span class=o>=</span> <span class=n>_curve</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span> <span class=o>=</span> <span class=n>_token</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=17:1><input checked=checked id=__tabbed_17_1 name=__tabbed_17 type=radio><div class=tabbed-labels><label for=__tabbed_17_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; zap.coins<span class=o>(</span><span class=m>0</span><span class=o>)</span>
<span class=s1>&#39;0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643&#39;</span>
&gt;&gt;&gt; zap.coins<span class=o>(</span><span class=m>1</span><span class=o>)</span>
<span class=s1>&#39;0x39AA39c021dfbaE8faC545936693aC917d5E7563&#39;</span>
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzaptoken_1><code>DepositZap.token</code><a class=headerlink href=#depositzaptoken_1 title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.token() → address: view</code></p> <p>Getter for the LP token of the associated pool.</p> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=hll><span class=n>lp_token</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>address</span><span class=p>)</span>
</span>
<span class=o>...</span>        

<span class=nd>@external</span>
<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=n>_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
    <span class=n>_underlying_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
    <span class=n>_curve</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span>
<span class=hll>    <span class=n>_token</span><span class=p>:</span> <span class=n>address</span>
</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Contract constructor</span>
<span class=sd>    @dev Where a token does not use wrapping, use the same address</span>
<span class=sd>         for `_coins` and `_underlying_coins`</span>
<span class=sd>    @param _coins List of wrapped coin addresses</span>
<span class=sd>    @param _underlying_coins List of underlying coin addresses</span>
<span class=sd>    @param _curve Pool address</span>
<span class=hll><span class=sd>    @param _token Pool LP token address</span>
</span><span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>assert</span> <span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=k>assert</span> <span class=n>_underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>

        <span class=c1># approve underlying and wrapped coins for infinite transfers</span>
        <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
            <span class=n>_underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
            <span class=n>concat</span><span class=p>(</span>
                <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;approve(address,uint256)&quot;</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>MAX_UINT256</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=p>),</span>
            <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
        <span class=n>_response</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
            <span class=n>_coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
            <span class=n>concat</span><span class=p>(</span>
                <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;approve(address,uint256)&quot;</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>_curve</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>MAX_UINT256</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=p>),</span>
            <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>coins</span> <span class=o>=</span> <span class=n>_coins</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span> <span class=o>=</span> <span class=n>_underlying_coins</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>curve</span> <span class=o>=</span> <span class=n>_curve</span>
<span class=hll>    <span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span> <span class=o>=</span> <span class=n>_token</span>
</span></code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=18:1><input checked=checked id=__tabbed_18_1 name=__tabbed_18 type=radio><div class=tabbed-labels><label for=__tabbed_18_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; zap.coins<span class=o>(</span><span class=m>0</span><span class=o>)</span>
<span class=s1>&#39;0x5d3a536E4D6DbD6114cc1Ead35777bAB948E3643&#39;</span>
&gt;&gt;&gt; zap.coins<span class=o>(</span><span class=m>1</span><span class=o>)</span>
<span class=s1>&#39;0x39AA39c021dfbaE8faC545936693aC917d5E7563&#39;</span>
</code></pre></div> </div> </div> </div> </div> <h3 id=addremove-liquidity_1>Add/Remove Liquidity<a class=headerlink href=#addremove-liquidity_1 title="Permanent link">&para;</a></h3> <h4 id=depositzapadd_liquidity_1><code>DepositZap.add_liquidity</code><a class=headerlink href=#depositzapadd_liquidity_1 title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.add_liquidity(_underlying_amounts: uint256[N_COINS], _min_mint_amount: uint256) -&gt; uint256</code></p> <p>Wrap underlying coins and deposit them in the pool. Returns the amount of LP token received in exchange for the deposited amounts.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_underlying_amounts</code></td> <td><code>uint256[N_COINS]</code></td> <td>List of amounts of underlying coins to deposit</td> </tr> <tr> <td><code>_min_mint_amount</code></td> <td><code>uint256</code></td> <td>Minimum amount of LP token to mint from the deposit</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">AddLiquidity</mark> </p> <details class=quote> <summary>Source code</summary> <div class="tabbed-set tabbed-alternate" data-tabs=19:2><input checked=checked id=__tabbed_19_1 name=__tabbed_19 type=radio><input id=__tabbed_19_2 name=__tabbed_19 type=radio><div class=tabbed-labels><label for=__tabbed_19_1>Zap Contract Methods</label><label for=__tabbed_19_2>Pool Methods</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@public</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>add_liquidity</span><span class=p>(</span><span class=n>uamounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>min_mint_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>):</span>
    <span class=n>tethered</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>TETHERED</span>
    <span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZEROS</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>uamount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>uamounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>

        <span class=k>if</span> <span class=n>uamount</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=c1># Transfer the underlying coin from owner</span>
            <span class=k>if</span> <span class=n>tethered</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
                <span class=n>USDT</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span>
                    <span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>uamount</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>\
                    <span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>uamount</span><span class=p>))</span>

            <span class=c1># Mint if needed</span>
            <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>approve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>uamount</span><span class=p>)</span>
            <span class=n>yERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>deposit</span><span class=p>(</span><span class=n>uamount</span><span class=p>)</span>
            <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>yERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
            <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>approve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>,</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>

    <span class=n>Curve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>)</span><span class=o>.</span><span class=n>add_liquidity</span><span class=p>(</span><span class=n>amounts</span><span class=p>,</span> <span class=n>min_mint_amount</span><span class=p>)</span>

    <span class=n>tokens</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
    <span class=n>assert_modifiable</span><span class=p>(</span><span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>token</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>tokens</span><span class=p>))</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>add_liquidity</span><span class=p>(</span><span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>min_mint_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Deposit coins into the pool</span>
<span class=sd>    @param amounts List of amounts of coins to deposit</span>
<span class=sd>    @param min_mint_amount Minimum amount of LP tokens to mint from the deposit</span>
<span class=sd>    @return Amount of LP tokens received by depositing</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_killed</span>  <span class=c1># dev: is killed</span>

    <span class=n>amp</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_A</span><span class=p>()</span>

    <span class=n>_lp_token</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span>
    <span class=n>token_supply</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>totalSupply</span><span class=p>()</span>
    <span class=c1># Initial invariant</span>
    <span class=n>D0</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>old_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>balances</span>
    <span class=k>if</span> <span class=n>token_supply</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>D0</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>old_balances</span><span class=p>,</span> <span class=n>amp</span><span class=p>)</span>
    <span class=n>new_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>old_balances</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>token_supply</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span>  <span class=c1># dev: initial deposit requires all coins</span>
        <span class=c1># balances store amounts of c-tokens</span>
        <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>old_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>

    <span class=c1># Invariant after change</span>
    <span class=n>D1</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>new_balances</span><span class=p>,</span> <span class=n>amp</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>D1</span> <span class=o>&gt;</span> <span class=n>D0</span>

    <span class=c1># We need to recalculate the invariant accounting for fees</span>
    <span class=c1># to calculate fair user&#39;s share</span>
    <span class=n>D2</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>D1</span>
    <span class=n>fees</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>empty</span><span class=p>(</span><span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>

    <span class=k>if</span> <span class=n>token_supply</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=c1># Only account for fees if we are not the first to deposit</span>
        <span class=n>_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fee</span> <span class=o>*</span> <span class=n>N_COINS</span> <span class=o>/</span> <span class=p>(</span><span class=mi>4</span> <span class=o>*</span> <span class=p>(</span><span class=n>N_COINS</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
        <span class=n>_admin_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>admin_fee</span>
        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
            <span class=n>ideal_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>D1</span> <span class=o>*</span> <span class=n>old_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>/</span> <span class=n>D0</span>
            <span class=n>difference</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>if</span> <span class=n>ideal_balance</span> <span class=o>&gt;</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
                <span class=n>difference</span> <span class=o>=</span> <span class=n>ideal_balance</span> <span class=o>-</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>difference</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>ideal_balance</span>
            <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>_fee</span> <span class=o>*</span> <span class=n>difference</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=p>(</span><span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>_admin_fee</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span><span class=p>)</span>
            <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=n>D2</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>new_balances</span><span class=p>,</span> <span class=n>amp</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>balances</span> <span class=o>=</span> <span class=n>new_balances</span>

    <span class=c1># Calculate, how much pool tokens to mint</span>
    <span class=n>mint_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>if</span> <span class=n>token_supply</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>mint_amount</span> <span class=o>=</span> <span class=n>D1</span>  <span class=c1># Take the dust if there was any</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>mint_amount</span> <span class=o>=</span> <span class=n>token_supply</span> <span class=o>*</span> <span class=p>(</span><span class=n>D2</span> <span class=o>-</span> <span class=n>D0</span><span class=p>)</span> <span class=o>/</span> <span class=n>D0</span>

    <span class=k>assert</span> <span class=n>mint_amount</span> <span class=o>&gt;=</span> <span class=n>min_mint_amount</span><span class=p>,</span> <span class=s2>&quot;Slippage screwed you&quot;</span>

    <span class=c1># Take coins from the sender</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=c1># &quot;safeTransferFrom&quot; which works for ERC20s which return bool or not</span>
            <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
                <span class=n>concat</span><span class=p>(</span>
                    <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;transferFrom(address,address,uint256)&quot;</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=p>),</span>
                <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
            <span class=p>)</span>  <span class=c1># dev: failed transfer</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>

    <span class=c1># Mint pool tokens</span>
    <span class=n>CurveToken</span><span class=p>(</span><span class=n>_lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>mint</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>mint_amount</span><span class=p>)</span>

    <span class=n>log</span> <span class=n>AddLiquidity</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>D1</span><span class=p>,</span> <span class=n>token_supply</span> <span class=o>+</span> <span class=n>mint_amount</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>mint_amount</span>
</code></pre></div> </div> </div> </div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=20:1><input checked=checked id=__tabbed_20_1 name=__tabbed_20 type=radio><div class=tabbed-labels><label for=__tabbed_20_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapremove_liquidity_1><code>DepositZap.remove_liquidity</code><a class=headerlink href=#depositzapremove_liquidity_1 title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.remove_liquidity(_amount: uint256, _min_underlying_amounts: uint256[N_COINS]) -&gt; uint256[N_COINS]</code></p> <p>Withdraw and unwrap coins from the pool. Returns list of amounts of underlying coins that were withdrawn.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_amount</code></td> <td><code>uint256</code></td> <td>Quantity of LP tokens to burn in the withdrawal</td> </tr> <tr> <td><code>_min_underlying_amounts</code></td> <td><code>uint256[N_COINS]</code></td> <td>Minimum amounts of underlying coins to receive</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">RemoveLiquidity</mark></p> <details class=quote> <summary>Source code</summary> <div class="tabbed-set tabbed-alternate" data-tabs=21:2><input checked=checked id=__tabbed_21_1 name=__tabbed_21 type=radio><input id=__tabbed_21_2 name=__tabbed_21 type=radio><div class=tabbed-labels><label for=__tabbed_21_1>Zap Contract Methods</label><label for=__tabbed_21_2>Pool Methods</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@internal</span>
<span class=k>def</span> <span class=nf>_unwrap_and_transfer</span><span class=p>(</span><span class=n>_addr</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_min_amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]:</span>
    <span class=c1># unwrap coins and transfer them to the sender</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=n>_amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>empty</span><span class=p>(</span><span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>_coin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=n>_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_coin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>_balance</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># Do nothing if there are 0 coins</span>
                <span class=k>continue</span>
            <span class=n>yERC20</span><span class=p>(</span><span class=n>_coin</span><span class=p>)</span><span class=o>.</span><span class=n>withdraw</span><span class=p>(</span><span class=n>_balance</span><span class=p>)</span>

        <span class=n>_ucoin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=n>_uamount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_ucoin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
        <span class=k>assert</span> <span class=n>_uamount</span> <span class=o>&gt;=</span> <span class=n>_min_amounts</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s2>&quot;Not enough coins withdrawn&quot;</span>

        <span class=c1># Send only if we have something to send</span>
        <span class=k>if</span> <span class=n>_uamount</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
                <span class=n>_ucoin</span><span class=p>,</span>
                <span class=n>concat</span><span class=p>(</span>
                    <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;transfer(address,uint256)&quot;</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>_addr</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>_uamount</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>)</span>
                <span class=p>),</span>
                <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
            <span class=n>_amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>_uamount</span>

    <span class=k>return</span> <span class=n>_amounts</span>

<span class=nd>@external</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity</span><span class=p>(</span>
    <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span>
    <span class=n>_min_underlying_amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Withdraw and unwrap coins from the pool</span>
<span class=sd>    @dev Withdrawal amounts are based on current deposit ratios</span>
<span class=sd>    @param _amount Quantity of LP tokens to burn in the withdrawal</span>
<span class=sd>    @param _min_underlying_amounts Minimum amounts of underlying coins to receive</span>
<span class=sd>    @return List of amounts of underlying coins that were withdrawn</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>
    <span class=n>Curve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>)</span><span class=o>.</span><span class=n>remove_liquidity</span><span class=p>(</span><span class=n>_amount</span><span class=p>,</span> <span class=n>empty</span><span class=p>(</span><span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]))</span>

    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_unwrap_and_transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>_min_underlying_amounts</span><span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity</span><span class=p>(</span><span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>min_amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Withdraw coins from the pool</span>
<span class=sd>    @dev Withdrawal amounts are based on current deposit ratios</span>
<span class=sd>    @param _amount Quantity of LP tokens to burn in the withdrawal</span>
<span class=sd>    @param min_amounts Minimum amounts of underlying coins to receive</span>
<span class=sd>    @return List of amounts of coins that were withdrawn</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>_lp_token</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span>
    <span class=n>total_supply</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>totalSupply</span><span class=p>()</span>
    <span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>empty</span><span class=p>(</span><span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
    <span class=n>fees</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>empty</span><span class=p>(</span><span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>  <span class=c1># Fees are unused but we&#39;ve got them historically in event</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>value</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>_amount</span> <span class=o>/</span> <span class=n>total_supply</span>
        <span class=k>assert</span> <span class=n>value</span> <span class=o>&gt;=</span> <span class=n>min_amounts</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s2>&quot;Withdrawal resulted in fewer coins than expected&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>value</span>
        <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
        <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
            <span class=n>concat</span><span class=p>(</span>
                <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;transfer(address,uint256)&quot;</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=n>convert</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=p>),</span>
            <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
        <span class=p>)</span>  <span class=c1># dev: failed transfer</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>

    <span class=n>CurveToken</span><span class=p>(</span><span class=n>_lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>burnFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>  <span class=c1># dev: insufficient funds</span>

    <span class=n>log</span> <span class=n>RemoveLiquidity</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>total_supply</span> <span class=o>-</span> <span class=n>_amount</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>amounts</span>
</code></pre></div> </div> </div> </div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=22:1><input checked=checked id=__tabbed_22_1 name=__tabbed_22 type=radio><div class=tabbed-labels><label for=__tabbed_22_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapremove_liquidity_imbalance_1><code>DepositZap.remove_liquidity_imbalance</code><a class=headerlink href=#depositzapremove_liquidity_imbalance_1 title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.remove_liquidity_imbalance(_underlying_amounts: uint256[N_COINS], _max_burn_amount: uint256)</code></p> <p>Withdraw and unwrap coins from the pool in an imbalanced amount. Amounts in <code>_underlying_amounts</code> correspond to withdrawn amounts before any fees charge for unwrapping Returns list of amounts of underlying coins that were withdrawn.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_underlying_amounts</code></td> <td><code>uint256[N_COINS]</code></td> <td>List of amounts of underlying coins to withdraw</td> </tr> <tr> <td><code>_max_burn_amount</code></td> <td><code>uint256</code></td> <td>Maximum amount of LP token to burn in the withdrawal</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">RemoveLiquidityImbalance</mark></p> <details class=quote> <summary>Source code</summary> <div class="tabbed-set tabbed-alternate" data-tabs=23:2><input checked=checked id=__tabbed_23_1 name=__tabbed_23 type=radio><input id=__tabbed_23_2 name=__tabbed_23 type=radio><div class=tabbed-labels><label for=__tabbed_23_1>Zap Contract Methods</label><label for=__tabbed_23_2>Pool Methods</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@internal</span>
<span class=k>def</span> <span class=nf>_unwrap_and_transfer</span><span class=p>(</span><span class=n>_addr</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_min_amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]:</span>
    <span class=c1># unwrap coins and transfer them to the sender</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=n>_amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>empty</span><span class=p>(</span><span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>_coin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
            <span class=n>_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_coin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>_balance</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># Do nothing if there are 0 coins</span>
                <span class=k>continue</span>
            <span class=n>yERC20</span><span class=p>(</span><span class=n>_coin</span><span class=p>)</span><span class=o>.</span><span class=n>withdraw</span><span class=p>(</span><span class=n>_balance</span><span class=p>)</span>

        <span class=n>_ucoin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=n>_uamount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_ucoin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
        <span class=k>assert</span> <span class=n>_uamount</span> <span class=o>&gt;=</span> <span class=n>_min_amounts</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s2>&quot;Not enough coins withdrawn&quot;</span>

        <span class=c1># Send only if we have something to send</span>
        <span class=k>if</span> <span class=n>_uamount</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
                <span class=n>_ucoin</span><span class=p>,</span>
                <span class=n>concat</span><span class=p>(</span>
                    <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;transfer(address,uint256)&quot;</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>_addr</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>_uamount</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>)</span>
                <span class=p>),</span>
                <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
            <span class=n>_amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>_uamount</span>

    <span class=k>return</span> <span class=n>_amounts</span>

<span class=nd>@external</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity_imbalance</span><span class=p>(</span>
    <span class=n>_underlying_amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span>
    <span class=n>_max_burn_amount</span><span class=p>:</span> <span class=n>uint256</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Withdraw and unwrap coins from the pool in an imbalanced amount</span>
<span class=sd>    @dev Amounts in `_underlying_amounts` correspond to withdrawn amounts</span>
<span class=sd>         before any fees charge for unwrapping.</span>
<span class=sd>    @param _underlying_amounts List of amounts of underlying coins to withdraw</span>
<span class=sd>    @param _max_burn_amount Maximum amount of LP token to burn in the withdrawal</span>
<span class=sd>    @return List of amounts of underlying coins that were withdrawn</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=n>lp_token</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span>

    <span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>_underlying_amounts</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=ow>and</span> <span class=n>_amount</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>rate</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>yERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>getPricePerFullShare</span><span class=p>()</span>
            <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>_amount</span> <span class=o>*</span> <span class=n>LENDING_PRECISION</span> <span class=o>/</span> <span class=n>rate</span>
        <span class=c1># if not use_lending - all good already</span>

    <span class=c1># Transfer max tokens in</span>
    <span class=n>_lp_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>_lp_amount</span> <span class=o>&gt;</span> <span class=n>_max_burn_amount</span><span class=p>:</span>
        <span class=n>_lp_amount</span> <span class=o>=</span> <span class=n>_max_burn_amount</span>
    <span class=k>assert</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>_lp_amount</span><span class=p>)</span>

    <span class=n>Curve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>)</span><span class=o>.</span><span class=n>remove_liquidity_imbalance</span><span class=p>(</span><span class=n>amounts</span><span class=p>,</span> <span class=n>_max_burn_amount</span><span class=p>)</span>

    <span class=c1># Transfer unused LP tokens back</span>
    <span class=n>_lp_amount</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>_lp_amount</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>assert</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>_lp_amount</span><span class=p>)</span>

    <span class=c1># Unwrap and transfer all the coins we&#39;ve got</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_unwrap_and_transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>empty</span><span class=p>(</span><span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]))</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity_imbalance</span><span class=p>(</span><span class=n>amounts</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>],</span> <span class=n>max_burn_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Withdraw coins from the pool in an imbalanced amount</span>
<span class=sd>    @param amounts List of amounts of underlying coins to withdraw</span>
<span class=sd>    @param max_burn_amount Maximum amount of LP token to burn in the withdrawal</span>
<span class=sd>    @return Actual amount of the LP token burned in the withdrawal</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_killed</span>  <span class=c1># dev: is killed</span>

    <span class=n>amp</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_A</span><span class=p>()</span>

    <span class=n>old_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>balances</span>
    <span class=n>new_balances</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>old_balances</span>
    <span class=n>D0</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>old_balances</span><span class=p>,</span> <span class=n>amp</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=n>D1</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>new_balances</span><span class=p>,</span> <span class=n>amp</span><span class=p>)</span>

    <span class=n>_lp_token</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span>
    <span class=n>token_supply</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>totalSupply</span><span class=p>()</span>
    <span class=k>assert</span> <span class=n>token_supply</span> <span class=o>!=</span> <span class=mi>0</span>  <span class=c1># dev: zero total supply</span>

    <span class=n>_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>fee</span> <span class=o>*</span> <span class=n>N_COINS</span> <span class=o>/</span> <span class=p>(</span><span class=mi>4</span> <span class=o>*</span> <span class=p>(</span><span class=n>N_COINS</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
    <span class=n>_admin_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>admin_fee</span>
    <span class=n>fees</span><span class=p>:</span> <span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>empty</span><span class=p>(</span><span class=n>uint256</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>])</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=n>ideal_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>D1</span> <span class=o>*</span> <span class=n>old_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>/</span> <span class=n>D0</span>
        <span class=n>difference</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>if</span> <span class=n>ideal_balance</span> <span class=o>&gt;</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
            <span class=n>difference</span> <span class=o>=</span> <span class=n>ideal_balance</span> <span class=o>-</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>difference</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>ideal_balance</span>
        <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>_fee</span> <span class=o>*</span> <span class=n>difference</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=p>(</span><span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>_admin_fee</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span><span class=p>)</span>
        <span class=n>new_balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=n>fees</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=n>D2</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_D_mem</span><span class=p>(</span><span class=n>new_balances</span><span class=p>,</span> <span class=n>amp</span><span class=p>)</span>

    <span class=n>token_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=p>(</span><span class=n>D0</span> <span class=o>-</span> <span class=n>D2</span><span class=p>)</span> <span class=o>*</span> <span class=n>token_supply</span> <span class=o>/</span> <span class=n>D0</span>
    <span class=k>assert</span> <span class=n>token_amount</span> <span class=o>!=</span> <span class=mi>0</span>  <span class=c1># dev: zero tokens burned</span>
    <span class=n>token_amount</span> <span class=o>+=</span> <span class=mi>1</span>  <span class=c1># In case of rounding errors - make it unfavorable for the &quot;attacker&quot;</span>
    <span class=k>assert</span> <span class=n>token_amount</span> <span class=o>&lt;=</span> <span class=n>max_burn_amount</span><span class=p>,</span> <span class=s2>&quot;Slippage screwed you&quot;</span>

    <span class=n>CurveToken</span><span class=p>(</span><span class=n>_lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>burnFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>token_amount</span><span class=p>)</span>  <span class=c1># dev: insufficient funds</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N_COINS</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
                <span class=n>concat</span><span class=p>(</span>
                    <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;transfer(address,uint256)&quot;</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>amounts</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=p>),</span>
                <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
            <span class=p>)</span>  <span class=c1># dev: failed transfer</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>


    <span class=n>log</span> <span class=n>RemoveLiquidityImbalance</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>amounts</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>D1</span><span class=p>,</span> <span class=n>token_supply</span> <span class=o>-</span> <span class=n>token_amount</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>token_amount</span>
</code></pre></div> </div> </div> </div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=24:1><input checked=checked id=__tabbed_24_1 name=__tabbed_24 type=radio><div class=tabbed-labels><label for=__tabbed_24_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=depositzapremove_liquidity_one_coin_1><code>DepositZap.remove_liquidity_one_coin</code><a class=headerlink href=#depositzapremove_liquidity_one_coin_1 title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>DepositZap.remove_liquidity_one_coin(_token_amount: uint256, i: int128, min_uamount: uint256, donate_dust: bool = False)</code></p> <p>Withdraw and unwrap a single coin from the pool. Returns amount of underlying coin received.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_amount</code></td> <td><code>uint256</code></td> <td>Amount of LP tokens to burn in the withdrawal</td> </tr> <tr> <td><code>i</code></td> <td><code>int128</code></td> <td>Index value of the coin to withdraw</td> </tr> <tr> <td><code>_min_underlying_amount</code></td> <td><code>uint256</code></td> <td>Minimum amount of underlying coin to receive</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">RemoveLiquidityOne</mark></p> <details class=quote> <summary>Source code</summary> <div class="tabbed-set tabbed-alternate" data-tabs=25:2><input checked=checked id=__tabbed_25_1 name=__tabbed_25 type=radio><input id=__tabbed_25_2 name=__tabbed_25 type=radio><div class=tabbed-labels><label for=__tabbed_25_1>Zap Contract Methods</label><label for=__tabbed_25_2>Pool Methods</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity_one_coin</span><span class=p>(</span>
    <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span>
    <span class=n>i</span><span class=p>:</span> <span class=n>int128</span><span class=p>,</span>
    <span class=n>_min_underlying_amount</span><span class=p>:</span> <span class=n>uint256</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Withdraw and unwrap a single coin from the pool</span>
<span class=sd>    @param _amount Amount of LP tokens to burn in the withdrawal</span>
<span class=sd>    @param i Index value of the coin to withdraw</span>
<span class=sd>    @param _min_underlying_amount Minimum amount of underlying coin to receive</span>
<span class=sd>    @return Amount of underlying coin received</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>ERC20</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>

    <span class=n>Curve</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>curve</span><span class=p>)</span><span class=o>.</span><span class=n>remove_liquidity_one_coin</span><span class=p>(</span><span class=n>_amount</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

    <span class=n>use_lending</span><span class=p>:</span> <span class=nb>bool</span><span class=p>[</span><span class=n>N_COINS</span><span class=p>]</span> <span class=o>=</span> <span class=n>USE_LENDING</span>
    <span class=k>if</span> <span class=n>use_lending</span><span class=p>[</span><span class=n>i</span><span class=p>]:</span>
        <span class=n>coin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
        <span class=n>_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>coin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
        <span class=n>yERC20</span><span class=p>(</span><span class=n>coin</span><span class=p>)</span><span class=o>.</span><span class=n>withdraw</span><span class=p>(</span><span class=n>_balance</span><span class=p>)</span>

    <span class=n>coin</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>underlying_coins</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
    <span class=n>_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>coin</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>_balance</span> <span class=o>&gt;=</span> <span class=n>_min_underlying_amount</span><span class=p>,</span> <span class=s2>&quot;Not enough coins removed&quot;</span>

    <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
        <span class=n>coin</span><span class=p>,</span>
        <span class=n>concat</span><span class=p>(</span>
            <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;transfer(address,uint256)&quot;</span><span class=p>),</span>
            <span class=n>convert</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=n>convert</span><span class=p>(</span><span class=n>_balance</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
        <span class=p>),</span>
        <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>_balance</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=nd>@nonreentrant</span><span class=p>(</span><span class=s1>&#39;lock&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>remove_liquidity_one_coin</span><span class=p>(</span><span class=n>_token_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>i</span><span class=p>:</span> <span class=n>int128</span><span class=p>,</span> <span class=n>_min_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Withdraw a single coin from the pool</span>
<span class=sd>    @param _token_amount Amount of LP tokens to burn in the withdrawal</span>
<span class=sd>    @param i Index value of the coin to withdraw</span>
<span class=sd>    @param _min_amount Minimum amount of coin to receive</span>
<span class=sd>    @return Amount of coin received</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_killed</span>  <span class=c1># dev: is killed</span>

    <span class=n>dy</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>dy_fee</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>total_supply</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>dy</span><span class=p>,</span> <span class=n>dy_fee</span><span class=p>,</span> <span class=n>total_supply</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_calc_withdraw_one_coin</span><span class=p>(</span><span class=n>_token_amount</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>dy</span> <span class=o>&gt;=</span> <span class=n>_min_amount</span><span class=p>,</span> <span class=s2>&quot;Not enough coins removed&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>balances</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-=</span> <span class=p>(</span><span class=n>dy</span> <span class=o>+</span> <span class=n>dy_fee</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>admin_fee</span> <span class=o>/</span> <span class=n>FEE_DENOMINATOR</span><span class=p>)</span>
    <span class=n>CurveToken</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lp_token</span><span class=p>)</span><span class=o>.</span><span class=n>burnFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>_token_amount</span><span class=p>)</span>  <span class=c1># dev: insufficient funds</span>


    <span class=n>_response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>coins</span><span class=p>[</span><span class=n>i</span><span class=p>],</span>
        <span class=n>concat</span><span class=p>(</span>
            <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;transfer(address,uint256)&quot;</span><span class=p>),</span>
            <span class=n>convert</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
            <span class=n>convert</span><span class=p>(</span><span class=n>dy</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
        <span class=p>),</span>
        <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
    <span class=p>)</span>  <span class=c1># dev: failed transfer</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>_response</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>_response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>

    <span class=n>log</span> <span class=n>RemoveLiquidityOne</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>_token_amount</span><span class=p>,</span> <span class=n>dy</span><span class=p>,</span> <span class=n>total_supply</span> <span class=o>-</span> <span class=n>_token_amount</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>dy</span>
</code></pre></div> </div> </div> </div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=26:1><input checked=checked id=__tabbed_26_1 name=__tabbed_26 type=radio><div class=tabbed-labels><label for=__tabbed_26_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2022-04-26T15:48:34+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2022-04-26</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../overview/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Overview </div> </div> </a> <a href=../metapool_deposits/ class="md-footer__link md-footer__link--next" aria-label="Next: Metapool Deposits" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Metapool Deposits </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.code.annotate", "content.tabs.link", "navigation.expand", "navigation.indexes", "navigation.instant", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.5e67fbfe.min.js"}</script> <script src=../../../assets/javascripts/bundle.e87a5f81.min.js></script> <script src=../../../js/timeago.min.js></script> <script src=../../../js/timeago_mkdocs_material.js></script> </body> </html>