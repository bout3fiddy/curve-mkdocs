<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=CurveFi><link href=https://bout3fiddy.github.io/curve-mkdocs/stableswap_exchange/cross_asset_swaps/synthswap_exchange/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.2.6"><title>SynthSwap - Curve Docs</title><link rel=stylesheet href=../../../assets/stylesheets/main.9d5733d3.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../css/timeago.css><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=red> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#adding-and-finding-swappable-assets class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Curve Docs" class="md-header__button md-logo" aria-label="Curve Docs" data-md-component=logo> <img src=../../../images/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Curve Docs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> SynthSwap </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/bout3fiddy/curve-mkdocs.git/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> bout3fiddy/curve-mkdocs </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Curve Docs" class="md-nav__button md-logo" aria-label="Curve Docs" data-md-component=logo> <img src=../../../images/logo.png alt=logo> </a> Curve Docs </label> <div class=md-nav__source> <a href=https://github.com/bout3fiddy/curve-mkdocs.git/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> bout3fiddy/curve-mkdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1 checked> <label class=md-nav__link for=__nav_1> Stableswap Exchange <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Stableswap Exchange" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Stableswap Exchange </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../overview/ class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 data-md-state=indeterminate type=checkbox id=__nav_1_2 checked> <label class=md-nav__link for=__nav_1_2> Pools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Pools data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Pools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../pools/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../pools/plain_pools/ class=md-nav__link> Plain Pools </a> </li> <li class=md-nav__item> <a href=../../pools/lending_pools/ class=md-nav__link> Lending Pools </a> </li> <li class=md-nav__item> <a href=../../pools/metapools/ class=md-nav__link> Metapools </a> </li> <li class=md-nav__item> <a href=../../pools/admin_pool_settings/ class=md-nav__link> Admin Controls </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_3 data-md-state=indeterminate type=checkbox id=__nav_1_3 checked> <label class=md-nav__link for=__nav_1_3> Liquidity Pool Tokens <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Liquidity Pool Tokens" data-md-level=2> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Liquidity Pool Tokens </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lp_tokens/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../lp_tokens/curve_token_v1/ class=md-nav__link> Curve Token V1 </a> </li> <li class=md-nav__item> <a href=../../lp_tokens/curve_token_v2/ class=md-nav__link> Curve Token V2 </a> </li> <li class=md-nav__item> <a href=../../lp_tokens/curve_token_v3/ class=md-nav__link> Curve Token V3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_4 data-md-state=indeterminate type=checkbox id=__nav_1_4 checked> <label class=md-nav__link for=__nav_1_4> Deposit Contracts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Deposit Contracts" data-md-level=2> <label class=md-nav__title for=__nav_1_4> <span class="md-nav__icon md-icon"></span> Deposit Contracts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../deposit_contracts/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../deposit_contracts/lending_pool_deposits/ class=md-nav__link> Lending Pool Deposits </a> </li> <li class=md-nav__item> <a href=../../deposit_contracts/metapool_deposits/ class=md-nav__link> Metapool Deposits </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_5 type=checkbox id=__nav_1_5 checked> <label class=md-nav__link for=__nav_1_5> Cross Asset Swaps <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cross Asset Swaps" data-md-level=2> <label class=md-nav__title for=__nav_1_5> <span class="md-nav__icon md-icon"></span> Cross Asset Swaps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> SynthSwap <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> SynthSwap </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#adding-and-finding-swappable-assets class=md-nav__link> Adding and Finding Swappable Assets </a> <nav class=md-nav aria-label="Adding and Finding Swappable Assets"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswapadd_synth class=md-nav__link> SynthSwap.add_synth </a> </li> <li class=md-nav__item> <a href=#synthswapsynth_pools class=md-nav__link> SynthSwap.synth_pools </a> </li> <li class=md-nav__item> <a href=#synthswapswappable_synth class=md-nav__link> SynthSwap.swappable_synth </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#estimate-swap-amounts class=md-nav__link> Estimate Swap Amounts </a> <nav class=md-nav aria-label="Estimate Swap Amounts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswapget_swap_into_synth_amount class=md-nav__link> SynthSwap.get_swap_into_synth_amount </a> </li> <li class=md-nav__item> <a href=#synthswapget_swap_from_synth_amount class=md-nav__link> SynthSwap.get_swap_from_synth_amount </a> </li> <li class=md-nav__item> <a href=#synthswapget_estimated_swap_amount class=md-nav__link> SynthSwap.get_estimated_swap_amount </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#initiate-a-swap class=md-nav__link> Initiate a Swap </a> <nav class=md-nav aria-label="Initiate a Swap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswapswap_into_synth class=md-nav__link> SynthSwap.swap_into_synth </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#get-info-about-an-unsettled-swap class=md-nav__link> Get Info about an Unsettled Swap </a> <nav class=md-nav aria-label="Get Info about an Unsettled Swap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswaptoken_info class=md-nav__link> SynthSwap.token_info </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#complete-a-swap class=md-nav__link> Complete a Swap </a> <nav class=md-nav aria-label="Complete a Swap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswapswap_from_synth class=md-nav__link> SynthSwap.swap_from_synth </a> </li> <li class=md-nav__item> <a href=#synthswapwithdraw class=md-nav__link> SynthSwap.withdraw </a> </li> <li class=md-nav__item> <a href=#synthswapsettle class=md-nav__link> SynthSwap.settle </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 data-md-state=indeterminate type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Cryptoswap Exchange <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cryptoswap Exchange" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Cryptoswap Exchange </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cryptoswap_exchange/overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 data-md-state=indeterminate type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Curve DAO <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Curve DAO" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Curve DAO </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../curve_dao/overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 data-md-state=indeterminate type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Registry <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Registry data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Registry </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../registry/overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 data-md-state=indeterminate type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Factory <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Factory data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Factory </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../factory/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../../factory/deployer_api/ class=md-nav__link> Deployer API </a> </li> <li class=md-nav__item> <a href=../../../factory/registry_api/ class=md-nav__link> Registry API </a> </li> <li class=md-nav__item> <a href=../../../factory/admin_controls/ class=md-nav__link> Admin Controls </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#adding-and-finding-swappable-assets class=md-nav__link> Adding and Finding Swappable Assets </a> <nav class=md-nav aria-label="Adding and Finding Swappable Assets"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswapadd_synth class=md-nav__link> SynthSwap.add_synth </a> </li> <li class=md-nav__item> <a href=#synthswapsynth_pools class=md-nav__link> SynthSwap.synth_pools </a> </li> <li class=md-nav__item> <a href=#synthswapswappable_synth class=md-nav__link> SynthSwap.swappable_synth </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#estimate-swap-amounts class=md-nav__link> Estimate Swap Amounts </a> <nav class=md-nav aria-label="Estimate Swap Amounts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswapget_swap_into_synth_amount class=md-nav__link> SynthSwap.get_swap_into_synth_amount </a> </li> <li class=md-nav__item> <a href=#synthswapget_swap_from_synth_amount class=md-nav__link> SynthSwap.get_swap_from_synth_amount </a> </li> <li class=md-nav__item> <a href=#synthswapget_estimated_swap_amount class=md-nav__link> SynthSwap.get_estimated_swap_amount </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#initiate-a-swap class=md-nav__link> Initiate a Swap </a> <nav class=md-nav aria-label="Initiate a Swap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswapswap_into_synth class=md-nav__link> SynthSwap.swap_into_synth </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#get-info-about-an-unsettled-swap class=md-nav__link> Get Info about an Unsettled Swap </a> <nav class=md-nav aria-label="Get Info about an Unsettled Swap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswaptoken_info class=md-nav__link> SynthSwap.token_info </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#complete-a-swap class=md-nav__link> Complete a Swap </a> <nav class=md-nav aria-label="Complete a Swap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#synthswapswap_from_synth class=md-nav__link> SynthSwap.swap_from_synth </a> </li> <li class=md-nav__item> <a href=#synthswapwithdraw class=md-nav__link> SynthSwap.withdraw </a> </li> <li class=md-nav__item> <a href=#synthswapsettle class=md-nav__link> SynthSwap.settle </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/bout3fiddy/curve-mkdocs.git/edit/master/docs/stableswap_exchange/cross_asset_swaps/synthswap_exchange.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>SynthSwap</h1> <p>This section discusses the different methods in the Curve <a href=https://etherscan.io/address/0x58A3c68e2D3aAf316239c003779F71aCb870Ee47>SynthSwap</a> contract.</p> <h3 id=adding-and-finding-swappable-assets>Adding and Finding Swappable Assets<a class=headerlink href=#adding-and-finding-swappable-assets title="Permanent link">&para;</a></h3> <p>In general, any asset that is within a Curve pool also containing a Synth may be used in a cross asset swap. </p> <h4 id=synthswapadd_synth><code>SynthSwap.add_synth</code><a class=headerlink href=#synthswapadd_synth title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>def add_synth(_synth: address, _pool: address)</code></p> <p>Add a new swappable synth. This method is callable by anyone, however <code>_pool</code> must exist within the Curve pool registry and <code>_synth</code> must be a valid synth that is swappable within the pool.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_synth</code></td> <td><code>address</code></td> <td>Address of the synth</td> </tr> <tr> <td><code>_pool</code></td> <td><code>address</code></td> <td>Address of Curve pool containing the synth</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">NewSynth</mark></p> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=k>def</span> <span class=nf>add_synth</span><span class=p>(</span><span class=n>_synth</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_pool</span><span class=p>:</span> <span class=n>address</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Add a new swappable synth</span>
<span class=sd>    @dev Callable by anyone, however `_pool` must exist within the Curve</span>
<span class=sd>         pool registry and `_synth` must be a valid synth that is swappable</span>
<span class=sd>         within the pool</span>
<span class=sd>    @param _synth Address of the synth to add</span>
<span class=sd>    @param _pool Address of the Curve pool where `_synth` is swappable</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=bp>self</span><span class=o>.</span><span class=n>synth_pools</span><span class=p>[</span><span class=n>_synth</span><span class=p>]</span> <span class=o>==</span> <span class=n>ZERO_ADDRESS</span>  <span class=c1># dev: already added</span>

    <span class=c1># this will revert if `_synth` is not actually a synth</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>_synth</span><span class=p>]</span> <span class=o>=</span> <span class=n>Synth</span><span class=p>(</span><span class=n>_synth</span><span class=p>)</span><span class=o>.</span><span class=n>currencyKey</span><span class=p>()</span>

    <span class=n>registry</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>AddressProvider</span><span class=p>(</span><span class=n>ADDRESS_PROVIDER</span><span class=p>)</span><span class=o>.</span><span class=n>get_registry</span><span class=p>()</span>
    <span class=n>pool_coins</span><span class=p>:</span> <span class=n>address</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>=</span> <span class=n>Registry</span><span class=p>(</span><span class=n>registry</span><span class=p>)</span><span class=o>.</span><span class=n>get_coins</span><span class=p>(</span><span class=n>_pool</span><span class=p>)</span>

    <span class=n>has_synth</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=k>for</span> <span class=n>coin</span> <span class=ow>in</span> <span class=n>pool_coins</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>coin</span> <span class=o>==</span> <span class=n>ZERO_ADDRESS</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>has_synth</span>  <span class=c1># dev: synth not in pool</span>
            <span class=k>break</span>
        <span class=k>if</span> <span class=n>coin</span> <span class=o>==</span> <span class=n>_synth</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>synth_pools</span><span class=p>[</span><span class=n>_synth</span><span class=p>]</span> <span class=o>=</span> <span class=n>_pool</span>
            <span class=n>has_synth</span> <span class=o>=</span> <span class=kc>True</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>swappable_synth</span><span class=p>[</span><span class=n>coin</span><span class=p>]</span> <span class=o>=</span> <span class=n>_synth</span>

    <span class=n>log</span> <span class=n>NewSynth</span><span class=p>(</span><span class=n>_synth</span><span class=p>,</span> <span class=n>_pool</span><span class=p>)</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=1:1><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=synthswapsynth_pools><code>SynthSwap.synth_pools</code><a class=headerlink href=#synthswapsynth_pools title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>SynthSwap.synth_pools(_synth: address) → address: view</code></p> <p>Get the address of the Curve pool used to swap a synthetic asset. If this function returns <code>ZERO_ADDRESS</code>, the given synth cannot be used within cross-asset swaps.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_synth</code></td> <td><code>address</code></td> <td>Address of the synth</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=c1># synth -&gt; curve pool where it can be traded</span>
<span class=n>synth_pools</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>HashMap</span><span class=p>[</span><span class=n>address</span><span class=p>,</span> <span class=n>address</span><span class=p>])</span>

<span class=o>...</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=2:1><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h4 id=synthswapswappable_synth><code>SynthSwap.swappable_synth</code><a class=headerlink href=#synthswapswappable_synth title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>SynthSwap.swappable_synth(_token: address) → address: view</code></p> <p>Get the address of the synthetic asset that <code>_token</code> may be directly swapped for. If this function returns <code>ZERO_ADDRESS</code>, <code>_token</code> cannot be used within a cross-asset swap.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_token</code></td> <td><code>address</code></td> <td>Address of the synth</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=c1># synth -&gt; curve pool where it can be traded</span>
<span class=n>synth_pools</span><span class=p>:</span> <span class=n>public</span><span class=p>(</span><span class=n>HashMap</span><span class=p>[</span><span class=n>address</span><span class=p>,</span> <span class=n>address</span><span class=p>])</span>

<span class=o>...</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; todo:
</code></pre></div> </div> </div> </div> </div> <h3 id=estimate-swap-amounts>Estimate Swap Amounts<a class=headerlink href=#estimate-swap-amounts title="Permanent link">&para;</a></h3> <h4 id=synthswapget_swap_into_synth_amount><code>SynthSwap.get_swap_into_synth_amount</code><a class=headerlink href=#synthswapget_swap_into_synth_amount title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>SynthSwap.get_swap_into_synth_amount(_from: address, _synth: address, _amount: uint256) → uint256: view</code></p> <p>Returns the expected amount of <code>_synth</code> received in the swap.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_from</code></td> <td><code>address</code></td> <td>Address of the initial asset being exchanged</td> </tr> <tr> <td><code>_synth</code></td> <td><code>address</code></td> <td>Address of the synth being swapped into</td> </tr> <tr> <td><code>_amount</code></td> <td><code>uint256</code></td> <td>Amount of _from to swap</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@view</span>
<span class=nd>@internal</span>
<span class=k>def</span> <span class=nf>_get_swap_into</span><span class=p>(</span><span class=n>_from</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_synth</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=n>registry</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>AddressProvider</span><span class=p>(</span><span class=n>ADDRESS_PROVIDER</span><span class=p>)</span><span class=o>.</span><span class=n>get_registry</span><span class=p>()</span>

    <span class=n>intermediate_synth</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>swappable_synth</span><span class=p>[</span><span class=n>_from</span><span class=p>]</span>
    <span class=n>pool</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>synth_pools</span><span class=p>[</span><span class=n>intermediate_synth</span><span class=p>]</span>

    <span class=n>synth_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>_amount</span>
    <span class=k>if</span> <span class=n>_from</span> <span class=o>!=</span> <span class=n>intermediate_synth</span><span class=p>:</span>
        <span class=n>i</span><span class=p>:</span> <span class=n>int128</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>j</span><span class=p>:</span> <span class=n>int128</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=n>Registry</span><span class=p>(</span><span class=n>registry</span><span class=p>)</span><span class=o>.</span><span class=n>get_coin_indices</span><span class=p>(</span><span class=n>pool</span><span class=p>,</span> <span class=n>_from</span><span class=p>,</span> <span class=n>intermediate_synth</span><span class=p>)</span>

        <span class=n>synth_amount</span> <span class=o>=</span> <span class=n>Curve</span><span class=p>(</span><span class=n>pool</span><span class=p>)</span><span class=o>.</span><span class=n>get_dy</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>

    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>exchanger</span><span class=o>.</span><span class=n>getAmountsForExchange</span><span class=p>(</span>
        <span class=n>synth_amount</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>intermediate_synth</span><span class=p>],</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>_synth</span><span class=p>],</span>
    <span class=p>)[</span><span class=mi>0</span><span class=p>]</span>


<span class=nd>@view</span>
<span class=nd>@external</span>
<span class=k>def</span> <span class=nf>get_swap_into_synth_amount</span><span class=p>(</span><span class=n>_from</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_synth</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Return the amount received when performing a cross-asset swap</span>
<span class=sd>    @dev Used to calculate `_expected` when calling `swap_into_synth`. Be sure to</span>
<span class=sd>         reduce the value slightly to account for market movement prior to the</span>
<span class=sd>         transaction confirmation.</span>
<span class=sd>    @param _from Address of the initial asset being exchanged</span>
<span class=sd>    @param _synth Address of the synth being swapped into</span>
<span class=sd>    @param _amount Amount of `_from` to swap</span>
<span class=sd>    @return uint256 Expected amount of `_synth` received</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_swap_into</span><span class=p>(</span><span class=n>_from</span><span class=p>,</span> <span class=n>_synth</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=4:1><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; <span class=nv>synth_swap</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x58A3c68e2D3aAf316239c003779F71aCb870Ee47&#39;</span><span class=o>)</span>
&gt;&gt;&gt; <span class=nv>dai</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x6b175474e89094c44da98b954eedeac495271d0f&#39;</span><span class=o>)</span>
&gt;&gt;&gt; <span class=nv>sbtc</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0xfe18be6b3bd88a2d2a7f928d00292e7a9963cfc6&#39;</span><span class=o>)</span>

&gt;&gt;&gt; synthswap.get_swap_into_synth_amount<span class=o>(</span>dai, sbtc, <span class=m>100000</span> * 1e18<span class=o>)</span>
<span class=m>2720559215249173192</span>
</code></pre></div> </div> </div> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This method is used to calculate <code>_expected</code> when calling <code>swap_into_synth</code>. You should reduce the value slightly to account for market movement prior to the transaction confirming.</p> </div> </div> <h4 id=synthswapget_swap_from_synth_amount><code>SynthSwap.get_swap_from_synth_amount</code><a class=headerlink href=#synthswapget_swap_from_synth_amount title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>SynthSwap.get_swap_from_synth_amount(_synth: address, _to: address, _amount: uint256) → uint256: view</code></p> <p>Returns the expected amount of <code>_to</code> received in the swap.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_synth</code></td> <td><code>address</code></td> <td>Address of the synth being swapped out of</td> </tr> <tr> <td><code>_to</code></td> <td><code>address</code></td> <td>Address of the asset to swap into</td> </tr> <tr> <td><code>_amount</code></td> <td><code>uint256</code></td> <td>Amount of <code>_synth</code> to swap</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@view</span>
<span class=nd>@internal</span>
<span class=k>def</span> <span class=nf>_get_swap_from</span><span class=p>(</span><span class=n>_synth</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=n>registry</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>AddressProvider</span><span class=p>(</span><span class=n>ADDRESS_PROVIDER</span><span class=p>)</span><span class=o>.</span><span class=n>get_registry</span><span class=p>()</span>
    <span class=n>pool</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>synth_pools</span><span class=p>[</span><span class=n>_synth</span><span class=p>]</span>

    <span class=n>i</span><span class=p>:</span> <span class=n>int128</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>j</span><span class=p>:</span> <span class=n>int128</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=n>Registry</span><span class=p>(</span><span class=n>registry</span><span class=p>)</span><span class=o>.</span><span class=n>get_coin_indices</span><span class=p>(</span><span class=n>pool</span><span class=p>,</span> <span class=n>_synth</span><span class=p>,</span> <span class=n>_to</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>Curve</span><span class=p>(</span><span class=n>pool</span><span class=p>)</span><span class=o>.</span><span class=n>get_dy</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>


<span class=nd>@view</span>
<span class=nd>@external</span>
<span class=k>def</span> <span class=nf>get_swap_from_synth_amount</span><span class=p>(</span><span class=n>_synth</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Return the amount received when swapping out of a settled synth</span>
<span class=sd>    @dev Used to calculate `_expected` when calling `swap_from_synth`. Be sure to</span>
<span class=sd>         reduce the value slightly to account for market movement prior to the</span>
<span class=sd>         transaction confirmation.</span>
<span class=sd>    @param _synth Address of the synth being swapped out of</span>
<span class=sd>    @param _to Address of the asset to swap into</span>
<span class=sd>    @param _amount Amount of `_synth` being exchanged</span>
<span class=sd>    @return uint256 Expected amount of `_to` received</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_swap_from</span><span class=p>(</span><span class=n>_synth</span><span class=p>,</span> <span class=n>_to</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=5:1><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; <span class=nv>synth_swap</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x58A3c68e2D3aAf316239c003779F71aCb870Ee47&#39;</span><span class=o>)</span>
&gt;&gt;&gt; <span class=nv>sbtc</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0xfe18be6b3bd88a2d2a7f928d00292e7a9963cfc6&#39;</span><span class=o>)</span>
&gt;&gt;&gt; <span class=nv>wbtc</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x2260fac5e5542a773aa44fbcfedf7c193bc2c599&#39;</span><span class=o>)</span>

&gt;&gt;&gt; synthswap.get_swap_from_synth_amount<span class=o>(</span>sbtc, wbtc, <span class=m>2720559215249173192</span><span class=o>)</span>
<span class=m>273663013</span>
</code></pre></div> </div> </div> </div> </div> <h4 id=synthswapget_estimated_swap_amount><code>SynthSwap.get_estimated_swap_amount</code><a class=headerlink href=#synthswapget_estimated_swap_amount title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>SynthSwap.get_estimated_swap_amount(_from: address, _to: address, _amount: uint256) → uint256: view</code></p> <p>Estimate the final amount of <code>_to</code> received when swapping between <code>_from</code> and <code>_to</code>.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_from</code></td> <td><code>address</code></td> <td>Address of the initial asset being exchanged</td> </tr> <tr> <td><code>_to</code></td> <td><code>address</code></td> <td>Address of the asset to swap into</td> </tr> <tr> <td><code>_amount</code></td> <td><code>uint256</code></td> <td>Amount of <code>_from</code> to swap</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@view</span>
<span class=nd>@internal</span>
<span class=k>def</span> <span class=nf>_get_swap_into</span><span class=p>(</span><span class=n>_from</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_synth</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=n>registry</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>AddressProvider</span><span class=p>(</span><span class=n>ADDRESS_PROVIDER</span><span class=p>)</span><span class=o>.</span><span class=n>get_registry</span><span class=p>()</span>

    <span class=n>intermediate_synth</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>swappable_synth</span><span class=p>[</span><span class=n>_from</span><span class=p>]</span>
    <span class=n>pool</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>synth_pools</span><span class=p>[</span><span class=n>intermediate_synth</span><span class=p>]</span>

    <span class=n>synth_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>_amount</span>
    <span class=k>if</span> <span class=n>_from</span> <span class=o>!=</span> <span class=n>intermediate_synth</span><span class=p>:</span>
        <span class=n>i</span><span class=p>:</span> <span class=n>int128</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>j</span><span class=p>:</span> <span class=n>int128</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=n>Registry</span><span class=p>(</span><span class=n>registry</span><span class=p>)</span><span class=o>.</span><span class=n>get_coin_indices</span><span class=p>(</span><span class=n>pool</span><span class=p>,</span> <span class=n>_from</span><span class=p>,</span> <span class=n>intermediate_synth</span><span class=p>)</span>

        <span class=n>synth_amount</span> <span class=o>=</span> <span class=n>Curve</span><span class=p>(</span><span class=n>pool</span><span class=p>)</span><span class=o>.</span><span class=n>get_dy</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>

    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>exchanger</span><span class=o>.</span><span class=n>getAmountsForExchange</span><span class=p>(</span>
        <span class=n>synth_amount</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>intermediate_synth</span><span class=p>],</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>_synth</span><span class=p>],</span>
    <span class=p>)[</span><span class=mi>0</span><span class=p>]</span>

<span class=o>...</span>

<span class=nd>@view</span>
<span class=nd>@internal</span>
<span class=k>def</span> <span class=nf>_get_swap_from</span><span class=p>(</span><span class=n>_synth</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=n>registry</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>AddressProvider</span><span class=p>(</span><span class=n>ADDRESS_PROVIDER</span><span class=p>)</span><span class=o>.</span><span class=n>get_registry</span><span class=p>()</span>
    <span class=n>pool</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>synth_pools</span><span class=p>[</span><span class=n>_synth</span><span class=p>]</span>

    <span class=n>i</span><span class=p>:</span> <span class=n>int128</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>j</span><span class=p>:</span> <span class=n>int128</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=n>Registry</span><span class=p>(</span><span class=n>registry</span><span class=p>)</span><span class=o>.</span><span class=n>get_coin_indices</span><span class=p>(</span><span class=n>pool</span><span class=p>,</span> <span class=n>_synth</span><span class=p>,</span> <span class=n>_to</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>Curve</span><span class=p>(</span><span class=n>pool</span><span class=p>)</span><span class=o>.</span><span class=n>get_dy</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>

<span class=o>...</span>

<span class=nd>@view</span>
<span class=nd>@external</span>
<span class=k>def</span> <span class=nf>get_estimated_swap_amount</span><span class=p>(</span><span class=n>_from</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span> <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Estimate the final amount received when swapping between `_from` and `_to`</span>
<span class=sd>    @dev Actual received amount may be different if synth rates change during settlement</span>
<span class=sd>    @param _from Address of the initial asset being exchanged</span>
<span class=sd>    @param _to Address of the asset to swap into</span>
<span class=sd>    @param _amount Amount of `_from` being exchanged</span>
<span class=sd>    @return uint256 Estimated amount of `_to` received</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>synth</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>swappable_synth</span><span class=p>[</span><span class=n>_to</span><span class=p>]</span>
    <span class=n>synth_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_swap_into</span><span class=p>(</span><span class=n>_from</span><span class=p>,</span> <span class=n>synth</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_swap_from</span><span class=p>(</span><span class=n>synth</span><span class=p>,</span> <span class=n>_to</span><span class=p>,</span> <span class=n>synth_amount</span><span class=p>)</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=6:1><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; <span class=nv>synth_swap</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x58A3c68e2D3aAf316239c003779F71aCb870Ee47&#39;</span><span class=o>)</span>
&gt;&gt;&gt; <span class=nv>dai</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x6b175474e89094c44da98b954eedeac495271d0f&#39;</span><span class=o>)</span>
&gt;&gt;&gt; <span class=nv>wbtc</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x2260fac5e5542a773aa44fbcfedf7c193bc2c599&#39;</span><span class=o>)</span>

&gt;&gt;&gt; synthswap.get_estimated_swap_amount<span class=o>(</span>dai, wbtc, <span class=m>100000</span> * 1e18<span class=o>)</span>
<span class=m>273663013</span>
</code></pre></div> </div> </div> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This method is for estimating the received amount from a complete swap over two transactions. If <code>_to</code> is a Synth, you should use <code>get_swap_into_synth_amount</code> instead.</p> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>As swaps take a settlement period into account, the actual received amount may be different due to rate changes during the settlement period.</p> </div> </div> <h3 id=initiate-a-swap>Initiate a Swap<a class=headerlink href=#initiate-a-swap title="Permanent link">&para;</a></h3> <h4 id=synthswapswap_into_synth><code>SynthSwap.swap_into_synth</code><a class=headerlink href=#synthswapswap_into_synth title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>SynthSwap.swap_into_synth(_from: address, _synth: address, _amount: uint256, _expected: uint256, _receiver: address = msg.sender, _existing_token_id: uint256 = 0) → uint256: payable</code></p> <p>Perform a cross-asset swap between <code>_from</code> and <code>_synth</code>. Returns the <code>uint256</code> token ID of the NFT representing the unsettled swap. The token ID is also available from the emitted <code>TokenUpdate</code> event.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_from</code></td> <td><code>address</code></td> <td>Address of the initial asset being exchanged. For Ether swaps, use <code>0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE</code>.</td> </tr> <tr> <td><code>_synth</code></td> <td><code>address</code></td> <td>Address of the synth to swap into</td> </tr> <tr> <td><code>_amount</code></td> <td><code>uint256</code></td> <td>Amount of <code>_from</code> to swap. If you are swapping from Ether, you must also send exactly this much Ether with the transaction. If you are swapping any other asset, you must have given approval to the swap contract to transfer at least this amount.</td> </tr> <tr> <td><code>_expected</code></td> <td><code>uint256</code></td> <td>Minimum amount of <code>_synth</code> to receive</td> </tr> <tr> <td><code>_receiver</code></td> <td><code>address</code></td> <td>Address of the recipient of <code>_synth</code>. Defaults to the <code>msg.sender</code>.</td> </tr> <tr> <td><code>_existing_token_id</code></td> <td><code>uint256</code></td> <td>Token ID to deposit <code>_synth</code> into. If not given, a new NFT is minted for the generated synth. When set as non-zero, the token ID must be owned by the caller and must already represent the same synth as is being swapped into.</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">NewSettler</mark> <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">TokenUpdate</mark></p> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@payable</span>
<span class=nd>@external</span>
<span class=k>def</span> <span class=nf>swap_into_synth</span><span class=p>(</span>
    <span class=n>_from</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span>
    <span class=n>_synth</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span>
    <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span>
    <span class=n>_expected</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span>
    <span class=n>_receiver</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span>
    <span class=n>_existing_token_id</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Perform a cross-asset swap between `_from` and `_synth`</span>
<span class=sd>    @dev Synth swaps require a settlement time to complete and so the newly</span>
<span class=sd>         generated synth cannot immediately be transferred onward. Calling</span>
<span class=sd>         this function mints an NFT which represents ownership of the generated</span>
<span class=sd>         synth. Once the settlement time has passed, the owner may claim the</span>
<span class=sd>         synth by calling to `swap_from_synth` or `withdraw`.</span>
<span class=sd>    @param _from Address of the initial asset being exchanged</span>
<span class=sd>    @param _synth Address of the synth being swapped into</span>
<span class=sd>    @param _amount Amount of `_from` to swap</span>
<span class=sd>    @param _expected Minimum amount of `_synth` to receive</span>
<span class=sd>    @param _receiver Address of the recipient of `_synth`, if not given</span>
<span class=sd>                       defaults to `msg.sender`</span>
<span class=sd>    @param _existing_token_id Token ID to deposit `_synth` into. If left as 0, a new NFT</span>
<span class=sd>                       is minted for the generated synth. If non-zero, the token ID</span>
<span class=sd>                       must be owned by `msg.sender` and must represent the same</span>
<span class=sd>                       synth as is being swapped into.</span>
<span class=sd>    @return uint256 NFT token ID</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>settler</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>ZERO_ADDRESS</span>
    <span class=n>token_id</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>

    <span class=k>if</span> <span class=n>_existing_token_id</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=c1># if no token ID is given we are initiating a new swap</span>
        <span class=n>count</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_count</span>
        <span class=k>if</span> <span class=n>count</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=c1># if there are no availale settler contracts we must deploy a new one</span>
            <span class=n>settler</span> <span class=o>=</span> <span class=n>create_forwarder_to</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>settler_implementation</span><span class=p>)</span>
            <span class=n>Settler</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span><span class=o>.</span><span class=n>initialize</span><span class=p>()</span>
            <span class=n>token_id</span> <span class=o>=</span> <span class=n>convert</span><span class=p>(</span><span class=n>settler</span><span class=p>,</span> <span class=n>uint256</span><span class=p>)</span>
            <span class=n>log</span> <span class=n>NewSettler</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>count</span> <span class=o>-=</span> <span class=mi>1</span>
            <span class=n>token_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>available_token_ids</span><span class=p>[</span><span class=n>count</span><span class=p>]</span>
            <span class=n>settler</span> <span class=o>=</span> <span class=n>convert</span><span class=p>(</span><span class=n>token_id</span> <span class=o>%</span> <span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>160</span><span class=p>),</span> <span class=n>address</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>id_count</span> <span class=o>=</span> <span class=n>count</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=c1># if a token ID is given we are adding to the balance of an existing swap</span>
        <span class=c1># so must check to make sure this is a permitted action</span>
        <span class=n>settler</span> <span class=o>=</span> <span class=n>convert</span><span class=p>(</span><span class=n>_existing_token_id</span> <span class=o>%</span> <span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>160</span><span class=p>),</span> <span class=n>address</span><span class=p>)</span>
        <span class=n>token_id</span> <span class=o>=</span> <span class=n>_existing_token_id</span>
        <span class=n>owner</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>_existing_token_id</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>!=</span> <span class=n>owner</span><span class=p>:</span>
            <span class=k>assert</span> <span class=n>owner</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=s2>&quot;Unknown Token ID&quot;</span>
            <span class=k>assert</span> <span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>owner_to_operators</span><span class=p>[</span><span class=n>owner</span><span class=p>][</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>]</span> <span class=ow>or</span>
                <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_approval</span><span class=p>[</span><span class=n>_existing_token_id</span><span class=p>]</span>
            <span class=p>),</span> <span class=s2>&quot;Caller is not owner or operator&quot;</span>
        <span class=k>assert</span> <span class=n>owner</span> <span class=o>==</span> <span class=n>_receiver</span><span class=p>,</span> <span class=s2>&quot;Receiver is not owner&quot;</span>
        <span class=k>assert</span> <span class=n>Settler</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span><span class=o>.</span><span class=n>synth</span><span class=p>()</span> <span class=o>==</span> <span class=n>_synth</span><span class=p>,</span> <span class=s2>&quot;Incorrect synth for Token ID&quot;</span>

    <span class=n>registry_swap</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>AddressProvider</span><span class=p>(</span><span class=n>ADDRESS_PROVIDER</span><span class=p>)</span><span class=o>.</span><span class=n>get_address</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
    <span class=n>intermediate_synth</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>swappable_synth</span><span class=p>[</span><span class=n>_from</span><span class=p>]</span>
    <span class=n>synth_amount</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>

    <span class=k>if</span> <span class=n>intermediate_synth</span> <span class=o>==</span> <span class=n>_from</span><span class=p>:</span>
        <span class=c1># if `_from` is already a synth, no initial curve exchange is required</span>
        <span class=k>assert</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_from</span><span class=p>)</span><span class=o>.</span><span class=n>transferFrom</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>settler</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>
        <span class=n>synth_amount</span> <span class=o>=</span> <span class=n>_amount</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>_from</span> <span class=o>!=</span> <span class=mh>0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE</span><span class=p>:</span>
            <span class=c1># Vyper equivalent of SafeERC20Transfer, handles most ERC20 return values</span>
            <span class=n>response</span><span class=p>:</span> <span class=n>Bytes</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
                <span class=n>_from</span><span class=p>,</span>
                <span class=n>concat</span><span class=p>(</span>
                    <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;transferFrom(address,address,uint256)&quot;</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                    <span class=n>convert</span><span class=p>(</span><span class=n>_amount</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                <span class=p>),</span>
                <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>response</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
                <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_approved</span><span class=p>[</span><span class=n>_from</span><span class=p>][</span><span class=n>registry_swap</span><span class=p>]:</span>
                <span class=n>response</span> <span class=o>=</span> <span class=n>raw_call</span><span class=p>(</span>
                    <span class=n>_from</span><span class=p>,</span>
                    <span class=n>concat</span><span class=p>(</span>
                        <span class=n>method_id</span><span class=p>(</span><span class=s2>&quot;approve(address,uint256)&quot;</span><span class=p>),</span>
                        <span class=n>convert</span><span class=p>(</span><span class=n>registry_swap</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                        <span class=n>convert</span><span class=p>(</span><span class=n>MAX_UINT256</span><span class=p>,</span> <span class=n>bytes32</span><span class=p>),</span>
                    <span class=p>),</span>
                    <span class=n>max_outsize</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>
                <span class=p>)</span>
                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>response</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
                    <span class=k>assert</span> <span class=n>convert</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>is_approved</span><span class=p>[</span><span class=n>_from</span><span class=p>][</span><span class=n>registry_swap</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>

        <span class=c1># use Curve to exchange for initial synth, which is sent to the settler</span>
        <span class=n>synth_amount</span> <span class=o>=</span> <span class=n>RegistrySwap</span><span class=p>(</span><span class=n>registry_swap</span><span class=p>)</span><span class=o>.</span><span class=n>exchange</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>synth_pools</span><span class=p>[</span><span class=n>intermediate_synth</span><span class=p>],</span>
            <span class=n>_from</span><span class=p>,</span>
            <span class=n>intermediate_synth</span><span class=p>,</span>
            <span class=n>_amount</span><span class=p>,</span>
            <span class=mi>0</span><span class=p>,</span>
            <span class=n>settler</span><span class=p>,</span>
            <span class=n>value</span><span class=o>=</span><span class=n>msg</span><span class=o>.</span><span class=n>value</span>
        <span class=p>)</span>

    <span class=c1># use Synthetix to convert initial synth into the target synth</span>
    <span class=n>initial_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_synth</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span>
    <span class=n>Settler</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span><span class=o>.</span><span class=n>convert_synth</span><span class=p>(</span>
        <span class=n>_synth</span><span class=p>,</span>
        <span class=n>synth_amount</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>intermediate_synth</span><span class=p>],</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>_synth</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=n>final_balance</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>_synth</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>final_balance</span> <span class=o>-</span> <span class=n>initial_balance</span> <span class=o>&gt;=</span> <span class=n>_expected</span><span class=p>,</span> <span class=s2>&quot;Rekt by slippage&quot;</span>

    <span class=c1># if this is a new swap, mint an NFT to represent the unsettled conversion</span>
    <span class=k>if</span> <span class=n>_existing_token_id</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>token_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>_receiver</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>owner_to_token_count</span><span class=p>[</span><span class=n>_receiver</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
        <span class=n>log</span> <span class=n>Transfer</span><span class=p>(</span><span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=n>_receiver</span><span class=p>,</span> <span class=n>token_id</span><span class=p>)</span>

    <span class=n>log</span> <span class=n>TokenUpdate</span><span class=p>(</span><span class=n>token_id</span><span class=p>,</span> <span class=n>_receiver</span><span class=p>,</span> <span class=n>_synth</span><span class=p>,</span> <span class=n>final_balance</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>token_id</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=7:1><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; <span class=nv>alice</span> <span class=o>=</span> accounts<span class=o>[</span><span class=m>0</span><span class=o>]</span>

&gt;&gt;&gt; <span class=nv>synth_swap</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x58A3c68e2D3aAf316239c003779F71aCb870Ee47&#39;</span><span class=o>)</span>
&gt;&gt;&gt; <span class=nv>dai</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x6b175474e89094c44da98b954eedeac495271d0f&#39;</span><span class=o>)</span>
&gt;&gt;&gt; <span class=nv>sbtc</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0xfe18be6b3bd88a2d2a7f928d00292e7a9963cfc6&#39;</span><span class=o>)</span>

&gt;&gt;&gt; <span class=nv>expected</span> <span class=o>=</span> synth_swap.get_swap_into_synth_amount<span class=o>(</span>dai, sbtc, dai.balanceOf<span class=o>(</span>alice<span class=o>))</span> * <span class=m>0</span>.99

&gt;&gt;&gt; <span class=nv>tx</span> <span class=o>=</span> synth_swap.swap_into_synth<span class=o>(</span>dai, sbtc, expected, <span class=o>{</span><span class=s1>&#39;from&#39;</span>: alice<span class=o>})</span>
Transaction sent: 0x83b311af19be08b8ec6241c3e834ccdf3b22586971de82a76a641e43bdf2b3ee
  Gas price: <span class=m>20</span> gwei   Gas limit: <span class=m>1200000</span>   Nonce: <span class=m>5</span>

&gt;&gt;&gt; tx.events<span class=o>[</span><span class=s1>&#39;TokenUpdate&#39;</span><span class=o>][</span><span class=s1>&#39;token_id&#39;</span><span class=o>]</span>
<span class=m>2423994707895209386239865227163451060473904619065</span>
</code></pre></div> </div> </div> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Synth swaps require a settlement time to complete and so the newly generated synth cannot immediately be transferred onward. Calling this function mints an NFT representing ownership of the unsettled synth.</p> </div> </div> <h3 id=get-info-about-an-unsettled-swap>Get Info about an Unsettled Swap<a class=headerlink href=#get-info-about-an-unsettled-swap title="Permanent link">&para;</a></h3> <h4 id=synthswaptoken_info><code>SynthSwap.token_info</code><a class=headerlink href=#synthswaptoken_info title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>SynthSwap.token_info(_token_id: uint256) → address, address, uint256, uint256: view</code></p> <p>Get information about the underlying synth represented by an NFT.</p> <p>Returns:</p> <ul> <li>the <code>address</code> of the owner of the NFT</li> <li>the <code>address</code> of the underlying synth</li> <li>the balance (<code>uint256</code>) of the underlying synth</li> <li>the current maximum number of seconds until the synth may be settled (<code>uint256</code>)</li> </ul> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_token_id</code></td> <td><code>uint256</code></td> <td>NFT token ID to query info about. Reverts if the token ID does not exist.</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@view</span>
<span class=nd>@external</span>
<span class=k>def</span> <span class=nf>token_info</span><span class=p>(</span><span class=n>_token_id</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TokenInfo</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Get information about the synth represented by an NFT</span>
<span class=sd>    @param _token_id NFT token ID to query info about</span>
<span class=sd>    @return NFT owner</span>
<span class=sd>            Address of synth within the NFT</span>
<span class=sd>            Balance of the synth</span>
<span class=sd>            Max settlement time in seconds</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>info</span><span class=p>:</span> <span class=n>TokenInfo</span> <span class=o>=</span> <span class=n>empty</span><span class=p>(</span><span class=n>TokenInfo</span><span class=p>)</span>
    <span class=n>info</span><span class=o>.</span><span class=n>owner</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span>
    <span class=k>assert</span> <span class=n>info</span><span class=o>.</span><span class=n>owner</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span>

    <span class=n>settler</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>convert</span><span class=p>(</span><span class=n>_token_id</span> <span class=o>%</span> <span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>160</span><span class=p>),</span> <span class=n>address</span><span class=p>)</span>
    <span class=n>info</span><span class=o>.</span><span class=n>synth</span> <span class=o>=</span> <span class=n>Settler</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span><span class=o>.</span><span class=n>synth</span><span class=p>()</span>
    <span class=n>info</span><span class=o>.</span><span class=n>underlying_balance</span> <span class=o>=</span> <span class=n>ERC20</span><span class=p>(</span><span class=n>info</span><span class=o>.</span><span class=n>synth</span><span class=p>)</span><span class=o>.</span><span class=n>balanceOf</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_settled</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]:</span>
        <span class=n>currency_key</span><span class=p>:</span> <span class=n>bytes32</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>info</span><span class=o>.</span><span class=n>synth</span><span class=p>]</span>
        <span class=n>reclaim</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>rebate</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=n>reclaim</span><span class=p>,</span> <span class=n>rebate</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>exchanger</span><span class=o>.</span><span class=n>settlementOwing</span><span class=p>(</span><span class=n>settler</span><span class=p>,</span> <span class=n>currency_key</span><span class=p>)</span>
        <span class=n>info</span><span class=o>.</span><span class=n>underlying_balance</span> <span class=o>=</span> <span class=n>info</span><span class=o>.</span><span class=n>underlying_balance</span> <span class=o>-</span> <span class=n>reclaim</span> <span class=o>+</span> <span class=n>rebate</span>
        <span class=n>info</span><span class=o>.</span><span class=n>time_to_settle</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>exchanger</span><span class=o>.</span><span class=n>maxSecsLeftInWaitingPeriod</span><span class=p>(</span><span class=n>settler</span><span class=p>,</span> <span class=n>currency_key</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>info</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=8:1><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><div class=tabbed-labels><label for=__tabbed_8_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; <span class=nv>synth_swap</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x58A3c68e2D3aAf316239c003779F71aCb870Ee47&#39;</span><span class=o>)</span>
&gt;&gt;&gt; synthswap.token_info<span class=o>(</span><span class=m>2423994707895209386239865227163451060473904619065</span><span class=o>)</span>.dict<span class=o>()</span>
<span class=o>{</span>
    <span class=s1>&#39;owner&#39;</span>: <span class=s2>&quot;0xEF422dBBF46120dE627fFb913C9AFaD44c735618&quot;</span>,
    <span class=s1>&#39;synth&#39;</span>: <span class=s2>&quot;0x57Ab1ec28D129707052df4dF418D58a2D46d5f51&quot;</span>,
    <span class=s1>&#39;time_to_settle&#39;</span>: <span class=m>0</span>,
    <span class=s1>&#39;underlying_balance&#39;</span>: <span class=m>1155647333395694644849</span>
<span class=o>}</span>
</code></pre></div> </div> </div> </div> </div> <h3 id=complete-a-swap>Complete a Swap<a class=headerlink href=#complete-a-swap title="Permanent link">&para;</a></h3> <h4 id=synthswapswap_from_synth><code>SynthSwap.swap_from_synth</code><a class=headerlink href=#synthswapswap_from_synth title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>SynthSwap.swap_from_synth(_token_id: uint256, _to: address, _amount: uint256, _expected: uint256, _receiver: address = msg.sender) → uint256: nonpayable</code></p> <p>Swap the underlying synth represented by an NFT into another asset. Callable by the owner or operator of <code>_token_id</code> after the synth settlement period has passed. If <code>_amount</code> is equal to the total remaining balance of the synth represented by the NFT, the NFT is burned. </p> <p>Returns the remaining balance of the underlying synth within the active NFT.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_token_id</code></td> <td><code>uint256</code></td> <td>The identifier for an NFT</td> </tr> <tr> <td><code>_to</code></td> <td><code>address</code></td> <td>Address of the asset to swap into</td> </tr> <tr> <td><code>_amount</code></td> <td><code>uint256</code></td> <td>Amount of the underlying synth to swap</td> </tr> <tr> <td><code>_expected</code></td> <td><code>uint256</code></td> <td>Minimum amount of <code>_to</code> to receive</td> </tr> <tr> <td><code>_receiver</code></td> <td><code>address</code></td> <td>Address to send the final received asset to. Defaults to <code>msg.sender</code>.</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">TokenUpdate</mark></p> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=k>def</span> <span class=nf>swap_from_synth</span><span class=p>(</span>
    <span class=n>_token_id</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span>
    <span class=n>_to</span><span class=p>:</span> <span class=n>address</span><span class=p>,</span>
    <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span>
    <span class=n>_expected</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span>
    <span class=n>_receiver</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Swap the synth represented by an NFT into another asset.</span>
<span class=sd>    @dev Callable by the owner or operator of `_token_id` after the synth settlement</span>
<span class=sd>         period has passed. If `_amount` is equal to the entire balance within</span>
<span class=sd>         the NFT, the NFT is burned.</span>
<span class=sd>    @param _token_id The identifier for an NFT</span>
<span class=sd>    @param _to Address of the asset to swap into</span>
<span class=sd>    @param _amount Amount of the synth to swap</span>
<span class=sd>    @param _expected Minimum amount of `_to` to receive</span>
<span class=sd>    @param _receiver Address of the recipient of the synth,</span>
<span class=sd>                     if not given defaults to `msg.sender`</span>
<span class=sd>    @return uint256 Synth balance remaining in `_token_id`</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>owner</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span>
    <span class=k>if</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]:</span>
        <span class=k>assert</span> <span class=n>owner</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=s2>&quot;Unknown Token ID&quot;</span>
        <span class=k>assert</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>owner_to_operators</span><span class=p>[</span><span class=n>owner</span><span class=p>][</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>]</span> <span class=ow>or</span>
            <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_approval</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span>
        <span class=p>),</span> <span class=s2>&quot;Caller is not owner or operator&quot;</span>

    <span class=n>settler</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>convert</span><span class=p>(</span><span class=n>_token_id</span> <span class=o>%</span> <span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>160</span><span class=p>),</span> <span class=n>address</span><span class=p>)</span>
    <span class=n>synth</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>swappable_synth</span><span class=p>[</span><span class=n>_to</span><span class=p>]</span>
    <span class=n>pool</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>synth_pools</span><span class=p>[</span><span class=n>synth</span><span class=p>]</span>

    <span class=c1># ensure the synth is settled prior to swapping</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_settled</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]:</span>
        <span class=n>currency_key</span><span class=p>:</span> <span class=n>bytes32</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>synth</span><span class=p>]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>exchanger</span><span class=o>.</span><span class=n>settle</span><span class=p>(</span><span class=n>settler</span><span class=p>,</span> <span class=n>currency_key</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>is_settled</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=c1># use Curve to exchange the synth for another asset which is sent to the receiver</span>
    <span class=n>remaining</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>Settler</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span><span class=o>.</span><span class=n>exchange</span><span class=p>(</span><span class=n>_to</span><span class=p>,</span> <span class=n>pool</span><span class=p>,</span> <span class=n>_amount</span><span class=p>,</span> <span class=n>_expected</span><span class=p>,</span> <span class=n>_receiver</span><span class=p>)</span>

    <span class=c1># if the balance of the synth within the NFT is now zero, burn the NFT</span>
    <span class=k>if</span> <span class=n>remaining</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>id_to_approval</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>is_settled</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>owner_to_token_count</span><span class=p>[</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>]</span> <span class=o>-=</span> <span class=mi>1</span>

        <span class=n>count</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_count</span>
        <span class=c1># add 2**160 to increment the nonce for next time this settler is used</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>available_token_ids</span><span class=p>[</span><span class=n>count</span><span class=p>]</span> <span class=o>=</span> <span class=n>_token_id</span> <span class=o>+</span> <span class=mi>2</span><span class=o>**</span><span class=mi>160</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>id_count</span> <span class=o>=</span> <span class=n>count</span> <span class=o>+</span> <span class=mi>1</span>

        <span class=n>owner</span> <span class=o>=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=n>synth</span> <span class=o>=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=n>log</span> <span class=n>Transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=n>_token_id</span><span class=p>)</span>

    <span class=n>log</span> <span class=n>TokenUpdate</span><span class=p>(</span><span class=n>_token_id</span><span class=p>,</span> <span class=n>owner</span><span class=p>,</span> <span class=n>synth</span><span class=p>,</span> <span class=n>remaining</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>remaining</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=9:1><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><div class=tabbed-labels><label for=__tabbed_9_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; <span class=nv>wbtc</span> <span class=o>=</span> Contract<span class=o>(</span><span class=s1>&#39;0x2260fac5e5542a773aa44fbcfedf7c193bc2c599&#39;</span><span class=o>)</span>

&gt;&gt;&gt; <span class=nv>amount</span> <span class=o>=</span> synth_swap.token_info<span class=o>(</span>token_id<span class=o>)[</span><span class=s1>&#39;underlying_balance&#39;</span><span class=o>]</span>
&gt;&gt;&gt; <span class=nv>expected</span> <span class=o>=</span> swynth_swap.get_swap_from_synth_amount<span class=o>(</span>sbtc, wbtc, amount<span class=o>)</span> * <span class=m>0</span>.99

&gt;&gt;&gt; synth_swap.swap_from_synth<span class=o>(</span>token_id, wbtc, amount, expected, <span class=o>{</span><span class=s1>&#39;from&#39;</span>: alice<span class=o>})</span>
Transaction sent: 0x83b311af19be08b8ec6241c3e834ccdf3b22586971de82a76a641e43bdf2b3ee
  Gas price: <span class=m>20</span> gwei   Gas limit: <span class=m>800000</span>   Nonce: <span class=m>6</span>
</code></pre></div> </div> </div> </div> </div> <h4 id=synthswapwithdraw><code>SynthSwap.withdraw</code><a class=headerlink href=#synthswapwithdraw title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>StableSwap.withdraw(_token_id: uint256, _amount: uint256, _receiver: address = msg.sender) → uint256: nonpayable</code></p> <p>Withdraw the underlying synth represented by an NFT. Callable by the owner or operator of <code>_token_id</code> after the synth settlement period has passed. If <code>_amount</code> is equal to the total remaining balance of the synth represented by the NFT, the NFT is burned.</p> <p>Returns the remaining balance of the underlying synth within the active NFT.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_token_id</code></td> <td><code>uint256</code></td> <td>The identifier for an NFT</td> </tr> <tr> <td><code>_amount</code></td> <td><code>uint256</code></td> <td>Amount of the underlying synth to swap</td> </tr> <tr> <td><code>_receiver</code></td> <td><code>address</code></td> <td>Address of the recipient of the withdrawn synth. Defaults to the <code>msg.sender</code>.</td> </tr> </tbody> </table> <p>Emits: <mark style="background-color: #FFD580; color: black">Transfer</mark> <mark style="background-color: #FFD580; color: black">TokenUpdate</mark></p> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=k>def</span> <span class=nf>withdraw</span><span class=p>(</span><span class=n>_token_id</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>_amount</span><span class=p>:</span> <span class=n>uint256</span><span class=p>,</span> <span class=n>_receiver</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>uint256</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Withdraw the synth represented by an NFT.</span>
<span class=sd>    @dev Callable by the owner or operator of `_token_id` after the synth settlement</span>
<span class=sd>         period has passed. If `_amount` is equal to the entire balance within</span>
<span class=sd>         the NFT, the NFT is burned.</span>
<span class=sd>    @param _token_id The identifier for an NFT</span>
<span class=sd>    @param _amount Amount of the synth to withdraw</span>
<span class=sd>    @param _receiver Address of the recipient of the synth,</span>
<span class=sd>                     if not given defaults to `msg.sender`</span>
<span class=sd>    @return uint256 Synth balance remaining in `_token_id`</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>owner</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span>
    <span class=k>if</span> <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]:</span>
        <span class=k>assert</span> <span class=n>owner</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=s2>&quot;Unknown Token ID&quot;</span>
        <span class=k>assert</span> <span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>owner_to_operators</span><span class=p>[</span><span class=n>owner</span><span class=p>][</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>]</span> <span class=ow>or</span>
            <span class=n>msg</span><span class=o>.</span><span class=n>sender</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_approval</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span>
        <span class=p>),</span> <span class=s2>&quot;Caller is not owner or operator&quot;</span>

    <span class=n>settler</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>convert</span><span class=p>(</span><span class=n>_token_id</span> <span class=o>%</span> <span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>160</span><span class=p>),</span> <span class=n>address</span><span class=p>)</span>
    <span class=n>synth</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>Settler</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span><span class=o>.</span><span class=n>synth</span><span class=p>()</span>

    <span class=c1># ensure the synth is settled prior to withdrawal</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_settled</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]:</span>
        <span class=n>currency_key</span><span class=p>:</span> <span class=n>bytes32</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>synth</span><span class=p>]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>exchanger</span><span class=o>.</span><span class=n>settle</span><span class=p>(</span><span class=n>settler</span><span class=p>,</span> <span class=n>currency_key</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>is_settled</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=n>remaining</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=n>Settler</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span><span class=o>.</span><span class=n>withdraw</span><span class=p>(</span><span class=n>_receiver</span><span class=p>,</span> <span class=n>_amount</span><span class=p>)</span>

    <span class=c1># if the balance of the synth within the NFT is now zero, burn the NFT</span>
    <span class=k>if</span> <span class=n>remaining</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>id_to_approval</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>is_settled</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>owner_to_token_count</span><span class=p>[</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>]</span> <span class=o>-=</span> <span class=mi>1</span>

        <span class=n>count</span><span class=p>:</span> <span class=n>uint256</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_count</span>
        <span class=c1># add 2**160 to increment the nonce for next time this settler is used</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>available_token_ids</span><span class=p>[</span><span class=n>count</span><span class=p>]</span> <span class=o>=</span> <span class=n>_token_id</span> <span class=o>+</span> <span class=mi>2</span><span class=o>**</span><span class=mi>160</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>id_count</span> <span class=o>=</span> <span class=n>count</span> <span class=o>+</span> <span class=mi>1</span>

        <span class=n>owner</span> <span class=o>=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=n>synth</span> <span class=o>=</span> <span class=n>ZERO_ADDRESS</span>
        <span class=n>log</span> <span class=n>Transfer</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>sender</span><span class=p>,</span> <span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=n>_token_id</span><span class=p>)</span>


    <span class=n>log</span> <span class=n>TokenUpdate</span><span class=p>(</span><span class=n>_token_id</span><span class=p>,</span> <span class=n>owner</span><span class=p>,</span> <span class=n>synth</span><span class=p>,</span> <span class=n>remaining</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>remaining</span>
</code></pre></div> </details> <div class="tabbed-set tabbed-alternate" data-tabs=10:1><input checked=checked id=__tabbed_10_1 name=__tabbed_10 type=radio><div class=tabbed-labels><label for=__tabbed_10_1>Example</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; <span class=nv>amount</span> <span class=o>=</span> synth_swap.token_info<span class=o>(</span>token_id<span class=o>)[</span><span class=s1>&#39;underlying_balance&#39;</span><span class=o>]</span>

&gt;&gt;&gt; synth_swap.withdraw<span class=o>(</span>token_id, amount, <span class=o>{</span><span class=s1>&#39;from&#39;</span>: alice<span class=o>})</span>
Transaction sent: 0x83b311af19be08b8ec6241c3e834ccdf3b22586971de82a76a641e43bdf2b3ee
  Gas price: <span class=m>20</span> gwei   Gas limit: <span class=m>800000</span>   Nonce: <span class=m>6</span>
</code></pre></div> </div> </div> </div> </div> <h4 id=synthswapsettle><code>SynthSwap.settle</code><a class=headerlink href=#synthswapsettle title="Permanent link">&para;</a></h4> <div class="admonition description"> <p class=admonition-title><code>StableSwap.settle(_token_id: uint256) → bool: nonpayable</code></p> <p>Settle the synth represented in an NFT. Note that settlement is performed when swapping or withdrawing, there is no requirement to call this function separately. Returns <code>True</code>.</p> <table> <thead> <tr> <th>Input</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>_token_id</code></td> <td><code>uint256</code></td> <td>The identifier for an NFT</td> </tr> </tbody> </table> <details class=quote> <summary>Source code</summary> <div class=highlight><pre><span></span><code><span class=nd>@external</span>
<span class=k>def</span> <span class=nf>settle</span><span class=p>(</span><span class=n>_token_id</span><span class=p>:</span> <span class=n>uint256</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    @notice Settle the synth represented in an NFT.</span>
<span class=sd>    @dev Settlement is performed when swapping or withdrawing, there</span>
<span class=sd>         is no requirement to call this function separately.</span>
<span class=sd>    @param _token_id The identifier for an NFT</span>
<span class=sd>    @return bool Success</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_settled</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]:</span>
        <span class=k>assert</span> <span class=bp>self</span><span class=o>.</span><span class=n>id_to_owner</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>!=</span> <span class=n>ZERO_ADDRESS</span><span class=p>,</span> <span class=s2>&quot;Unknown Token ID&quot;</span>

        <span class=n>settler</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>convert</span><span class=p>(</span><span class=n>_token_id</span> <span class=o>%</span> <span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>160</span><span class=p>),</span> <span class=n>address</span><span class=p>)</span>
        <span class=n>synth</span><span class=p>:</span> <span class=n>address</span> <span class=o>=</span> <span class=n>Settler</span><span class=p>(</span><span class=n>settler</span><span class=p>)</span><span class=o>.</span><span class=n>synth</span><span class=p>()</span>
        <span class=n>currency_key</span><span class=p>:</span> <span class=n>bytes32</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>currency_keys</span><span class=p>[</span><span class=n>synth</span><span class=p>]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>exchanger</span><span class=o>.</span><span class=n>settle</span><span class=p>(</span><span class=n>settler</span><span class=p>,</span> <span class=n>currency_key</span><span class=p>)</span>  <span class=c1># dev: settlement failed</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>is_settled</span><span class=p>[</span><span class=n>_token_id</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=k>return</span> <span class=kc>True</span>
</code></pre></div> </details> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2022-04-26T15:48:34+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2022-04-26</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../overview/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Overview </div> </div> </a> <a href=../../../cryptoswap_exchange/overview/ class="md-footer__link md-footer__link--next" aria-label="Next: Overview" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Overview </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.code.annotate", "content.tabs.link", "navigation.expand", "navigation.indexes", "navigation.instant", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.5e67fbfe.min.js"}</script> <script src=../../../assets/javascripts/bundle.e87a5f81.min.js></script> <script src=../../../js/timeago.min.js></script> <script src=../../../js/timeago_mkdocs_material.js></script> </body> </html>